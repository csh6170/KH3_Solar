<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ï¢ÖÌï© ÎÇ†Ïî® Ï†ïÎ≥¥</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js (Í∑∏ÎûòÌîÑÏö©) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- FontAwesome (ÏïÑÏù¥ÏΩò) -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        .bg-transition { transition: background-image 0.5s ease-in-out; }
        .sun-path {
            stroke-dasharray: 251.2; /* 2 * PI * R (40) roughly 251 */
            stroke-dashoffset: 251.2;
            transition: stroke-dashoffset 2s ease-out;
        }
    </style>
</head>

<!-- Î∞∞Í≤Ω Ïù¥ÎØ∏ÏßÄ ÎèôÏ†Å Î∞îÏù∏Îî© & Î∞∞Í≤Ω ÏÑ§Ï†ï -->
<body class="min-h-screen p-4 md:p-8 bg-cover bg-center bg-fixed bg-no-repeat bg-transition"
      th:style="'background-image: url(' + ${weather.bgImageUrl} + ');'">

<!-- Î∞∞Í≤Ω Ïò§Î≤ÑÎ†àÏù¥ - Í∏ÄÏûê Í∞ÄÎèÖÏÑ±ÏùÑ ÏúÑÌï¥ ÌïÑÏàò -->
<div class="fixed inset-0 bg-black/30 z-0 pointer-events-none"></div>

<!-- Î©îÏù∏ Ïª®ÌÖêÏ∏† ÎûòÌçº -->
<div class="max-w-5xl mx-auto relative z-10">

    <!-- 1. ÏÉÅÎã® Ìó§Îçî & ÏßÄÏó≠ ÏÑ†ÌÉù -->
    <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
        <div>
            <div class="inline-flex items-center justify-center  gap-2 mb-1">
                <div class="w-12 h-12 rounded-2xl bg-gradient-to-tr from-blue-500 to-cyan-400 flex items-center justify-center shadow-lg shadow-blue-500/30">
                    <i class="fas fa-satellite-dish text-white text-2xl animate-pulse"></i>
                </div>
                <div>
                    <h1 class="text-3xl md:text-4xl font-extrabold text-white tracking-tight drop-shadow-lg">
                        Í∏∞ÏÉÅÏ≤≠ ÏòàÎ≥¥ <span class="text-cyan-300">ÎåÄÏãúÎ≥¥Îìú</span>
                    </h1>
                </div>
            </div>
            <p class="text-white/90 text-xs font-medium tracking-wide">
                Live Update: <span class="font-bold text-white" th:text="${weather.baseDate} + ' ' + ${weather.baseTime}"></span>
            </p>
        </div>

        <button onclick="openModal()"
                class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 px-8 rounded-2xl shadow-lg transition transform hover:scale-105 flex items-center gap-3">
            <i class="fas fa-solar-panel"></i>
            <span>ÌÉúÏñëÍ¥ë Î∞úÏ†Ñ ÏòàÏ∏°ÌïòÍ∏∞</span>
        </button>

        <!-- ÌÉúÏñëÍ¥ë Î∞úÏ†Ñ ÏòàÏ∏° Î™®Îã¨ -->
        <div id="predictModal" class="fixed inset-0 z-50 hidden overflow-y-auto">
            <div class="flex items-center justify-center min-h-screen p-4 text-center">
                <div class="fixed inset-0 bg-black opacity-50 transition-opacity" onclick="closeModal()"></div>

                <div class="relative bg-white rounded-3xl overflow-hidden shadow-2xl transform transition-all max-w-lg w-full z-50">

                    <button onclick="closeModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 z-[60]">
                        <i class="fas fa-times text-xl"></i>
                    </button>

                    <iframe src="/predict-form"
                            class="w-full h-[900px] border-none"
                            id="predictFrame">
                    </iframe>
                </div>
            </div>
        </div>

        <!-- ÏßÄÏó≠ ÏÑ†ÌÉù ÎìúÎ°≠Îã§Ïö¥ -->
        <div class="relative w-full md:w-64">
            <select onchange="const c=this.value.split(','); location.href='/?nx='+c[0]+'&ny='+c[1]"
                    class="w-full p-3 rounded-xl border-none bg-white/80 backdrop-blur-md font-bold text-gray-700 shadow-lg focus:ring-2 focus:ring-blue-400 outline-none cursor-pointer hover:bg-white/90 transition">
                <option th:each="region : ${regions}"
                        th:value="${region.nx} + ',' + ${region.ny}"
                        th:text="${region.name}"
                        th:selected="${region.nx == currentNx && region.ny == currentNy}">ÏßÄÏó≠</option>
            </select>
            <div class="absolute inset-y-0 right-0 flex items-center px-4 pointer-events-none text-gray-600">
                <i class="fas fa-map-marker-alt"></i>
            </div>
        </div>
    </div>

    <!-- 2. Î©îÏù∏ ÎÇ†Ïî® Ïπ¥Îìú -->
    <a href="https://www.kma.go.kr/w/iframe/dfs.do" target="_blank" class="block hover-card">
        <div class="bg-white/90 backdrop-blur-md rounded-3xl p-8 text-gray-800 shadow-2xl mb-6 flex flex-col md:flex-row items-center justify-between border border-white/50">
            <div class="text-center md:text-left">
                <h2 class="text-2xl font-bold mb-2 text-gray-700 flex items-center justify-center md:justify-start gap-2">
                    <i class="fas fa-location-dot text-blue-500"></i>
                    <span th:text="${currentRegionName}">ÏßÄÏó≠Î™Ö</span>
                </h2>
                <!-- ÌòÑÏû¨ Ïò®ÎèÑ -->
                <div class="text-7xl font-extrabold mb-2 text-gray-900 tracking-tight">
                    <span th:text="${weather.TMP}">-</span><span class="text-4xl align-top">¬∞</span>
                </div>
                <!-- ÎÇ†Ïî® ÏÉÅÌÉú Î∞è ÏµúÏ†Ä/ÏµúÍ≥† Í∏∞Ïò® -->
                <p class="text-xl font-medium text-gray-600">
                    <span th:text="${weather.SKY}">-</span>
                    <span th:if="${weather.PTY != 'Í∞ïÏàòÏóÜÏùå'}" th:text="'/ ' + ${weather.PTY}"></span>
                </p>
                <div class="mt-6 flex gap-4 text-sm bg-gray-100/80 p-3 rounded-xl inline-flex shadow-inner">
                    <span class="flex items-center gap-1"><i class="fas fa-temperature-low text-blue-500"></i> ÏµúÏ†Ä <span th:text="${weather.TMN != null ? weather.TMN : '-'}"></span>¬∞</span>
                    <span class="w-px h-4 bg-gray-300"></span>
                    <span class="flex items-center gap-1"><i class="fas fa-temperature-high text-red-500"></i> ÏµúÍ≥† <span th:text="${weather.TMX != null ? weather.TMX : '-'}"></span>¬∞</span>
                    <span class="w-px h-4 bg-gray-300"></span>
                    <span class="flex items-center gap-1"><i class="fas fa-user-check text-indigo-500"></i> Ï≤¥Í∞ê <span th:text="${weather.sensibleTemp != null ? weather.sensibleTemp : '-'}"></span>¬∞</span>
                </div>
            </div>

            <!-- ÎÇ†Ïî® ÏïÑÏù¥ÏΩò -->
            <div class="mt-8 md:mt-0 transform">
                <i th:if="${weather.PTY == 'ÎπÑ'}" class="fas fa-cloud-showers-heavy text-9xl text-blue-500 animate-bounce drop-shadow-xl"></i>
                <i th:if="${weather.PTY == 'Îàà'}" class="fas fa-snowflake text-9xl text-sky-300 animate-spin-slow drop-shadow-xl"></i>
                <i th:if="${weather.PTY == 'ÎπÑ/Îàà'}" class="fas fa-cloud-meatball text-9xl text-gray-400 animate-pulse drop-shadow-xl"></i>
                <i th:if="${weather.PTY == 'ÏÜåÎÇòÍ∏∞'}" class="fas fa-cloud-showers-water text-9xl text-blue-600 animate-bounce drop-shadow-xl"></i>
                <i th:if="${weather.PTY == 'ÎπóÎ∞©Ïö∏'}" class="fas fa-cloud-rain text-9xl text-blue-400 animate-pulse drop-shadow-xl"></i>
                <i th:if="${weather.PTY == 'Í∞ïÏàòÏóÜÏùå' && weather.SKY == 'ÎßëÏùå'}" class="fas fa-sun text-9xl text-yellow-400 animate-pulse drop-shadow-[0_0_15px_rgba(250,204,21,0.6)]"></i>
                <i th:if="${weather.PTY == 'Í∞ïÏàòÏóÜÏùå' && weather.SKY == 'Íµ¨Î¶ÑÎßéÏùå'}" class="fas fa-cloud-sun text-9xl text-gray-400 drop-shadow-xl"></i>
                <i th:if="${weather.PTY == 'Í∞ïÏàòÏóÜÏùå' && weather.SKY == 'ÌùêÎ¶º'}" class="fas fa-cloud text-9xl text-gray-500 drop-shadow-xl"></i>
            </div>
        </div>
    </a>

    <!-- 3. [ÌÜµÌï©] AI ÎùºÏù¥ÌîÑÏä§ÌÉÄÏùº Îß§ÎãàÏ†Ä (Ï†ëÍ∏∞/ÌéºÏπòÍ∏∞ Í∏∞Îä• Ï∂îÍ∞Ä) -->
    <div class="bg-white/95 backdrop-blur-md rounded-3xl shadow-xl overflow-hidden mb-8 transition-all duration-300">
        <!-- ÏÉÅÎã® Ìó§Îçî -->
        <div class="bg-gradient-to-r from-indigo-600 to-purple-600 px-6 py-4 flex items-center justify-between cursor-pointer" onclick="toggleAiManager()">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl shadow-inner">
                    ü§ñ
                </div>
                <h3 class="text-lg font-bold text-white tracking-wide">AI ÎùºÏù¥ÌîÑÏä§ÌÉÄÏùº Îß§ÎãàÏ†Ä</h3>
            </div>

            <div class="flex items-center gap-3">
                <!-- Î∏åÎ¶¨Ìïë Îì£Í∏∞ Î≤ÑÌäº (Ïù¥Î≤§Ìä∏ Î≤ÑÎ∏îÎßÅ Î∞©ÏßÄÎ•º ÏúÑÌï¥ onclickÏóê event.stopPropagation() Ï∂îÍ∞Ä Í∂åÏû•) -->
                <button onclick="speakBriefing(); event.stopPropagation();" class="flex items-center gap-2 bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-full text-sm font-bold transition active:scale-95 backdrop-blur-sm border border-white/10">
                    <i class="fas fa-volume-up"></i> <span class="hidden sm:inline">Î∏åÎ¶¨Ìïë Îì£Í∏∞</span>
                </button>

                <!-- Ï†ëÍ∏∞/ÌéºÏπòÍ∏∞ ÌÜ†Í∏Ä Î≤ÑÌäº -->
                <button class="w-8 h-8 flex items-center justify-center rounded-full bg-white/20 hover:bg-white/30 text-white transition backdrop-blur-sm border border-white/10">
                    <i id="aiToggleIcon" class="fas fa-chevron-up transition-transform duration-500"></i>
                </button>
            </div>
        </div>

        <!-- Ïª®ÌÖêÏ∏† ÏòÅÏó≠ (Ïï†ÎãàÎ©îÏù¥ÏÖòÏùÑ ÏúÑÌïú ÎûòÌçº Ï∂îÍ∞Ä) -->
        <!-- max-h-[1000px]ÏùÄ ÎÇ¥Ïö©Î¨ºÎ≥¥Îã§ Ï∂©Î∂ÑÌûà ÌÅ∞ Í∞íÏù¥Ïñ¥Ïïº Ìï®. ÎÇ¥Ïö©Î¨ºÏù¥ Î≥¥Ïùº Îïå ÏÇ¨Ïö©. -->
        <div id="aiManagerContent" class="transition-all duration-500 ease-in-out max-h-[1000px] opacity-100 overflow-hidden">
            <div class="flex flex-col md:flex-row">
                <!-- ÏôºÏ™Ω: AI Í∏∞ÏÉÅ Ï∫êÏä§ÌÑ∞ Î∏åÎ¶¨Ìïë -->
                <div class="flex-1 p-6 md:p-8 border-b md:border-b-0 md:border-r border-gray-100 bg-indigo-50/30">
                    <div class="flex gap-4 items-start">
                        <div class="flex-shrink-0 text-center">
                            <div class="w-16 h-16 rounded-full bg-white border-2 border-indigo-200 flex items-center justify-center text-3xl shadow-sm mb-2">
                                üë©‚Äçüíº
                            </div>
                            <span class="text-[10px] font-bold text-indigo-500 uppercase tracking-wider bg-indigo-100 px-2 py-0.5 rounded-full">Caster</span>
                        </div>
                        <div class="flex-1">
                            <h4 class="text-sm font-bold text-indigo-800 mb-2 flex items-center gap-2">
                                <i class="fas fa-microphone-alt"></i> Ïò§ÎäòÏùò ÎÇ†Ïî® Î∏åÎ¶¨Ìïë
                            </h4>
                            <div class="bg-white p-4 rounded-xl rounded-tl-none border border-indigo-100 shadow-sm relative">
                                <p id="aiBriefingText" class="text-gray-700 leading-relaxed font-medium text-sm md:text-base" th:utext="${weather.aiBriefing}">
                                    Ï∫êÏä§ÌÑ∞Í∞Ä ÎåÄÎ≥∏ÏùÑ Ï§ÄÎπÑÏ§ëÏûÖÎãàÎã§...
                                </p>
                                <div class="absolute top-0 -left-2 w-4 h-4 bg-white border-t border-l border-indigo-100 transform -rotate-45"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ïò§Î•∏Ï™Ω: AI Ïò∑Ï∞®Î¶º Ï∂îÏ≤ú -->
                <div class="flex-1 p-6 md:p-8 bg-purple-50/30">
                    <div class="flex gap-4 items-start">
                        <div class="flex-shrink-0 text-center">
                            <div class="w-16 h-16 rounded-full bg-white border-2 border-purple-200 flex items-center justify-center text-3xl shadow-sm mb-2">
                                üëó
                            </div>
                            <span class="text-[10px] font-bold text-purple-500 uppercase tracking-wider bg-purple-100 px-2 py-0.5 rounded-full">Stylist</span>
                        </div>
                        <div class="flex-1">
                            <h4 class="text-sm font-bold text-purple-800 mb-2 flex items-center gap-2">
                                <i class="fas fa-tshirt"></i> Ïò§ÎäòÏùò Ïò∑Ï∞®Î¶º Ï∂îÏ≤ú
                            </h4>
                            <div class="bg-white p-4 rounded-xl rounded-tl-none border border-purple-100 shadow-sm relative flex flex-col gap-2">
                                <div class="flex items-center gap-3 mb-1">
                                    <div class="w-8 h-8 rounded-lg bg-purple-100 flex items-center justify-center text-purple-600">
                                        <i th:class="${weather.outfitIcon}"></i>
                                    </div>
                                    <span class="font-bold text-gray-800">Today's Pick!</span>
                                </div>
                                <p class="text-gray-700 leading-relaxed font-medium text-sm md:text-base">
                                    <span th:utext="${weather.clothingRecommendation}"></span>
                                </p>
                                <div class="absolute top-0 -left-2 w-4 h-4 bg-white border-t border-l border-purple-100 transform -rotate-45"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 4. Ìñ•ÌõÑ 6ÏãúÍ∞Ñ ÏÉÅÏÑ∏ ÏòàÎ≥¥ (Ï∞®Ìä∏ Ìè¨Ìï®) -->
    <div class="mb-8">
        <h3 class="text-xl font-bold text-white mb-4 px-1 flex items-center drop-shadow-md">
            <i class="fas fa-history text-blue-300 mr-2"></i>Ìñ•ÌõÑ 6ÏãúÍ∞Ñ ÏòàÎ≥¥
        </h3>

        <!-- Í∞ÄÎ°ú Ïä§ÌÅ¨Î°§ Ïπ¥Îìú Î¶¨Ïä§Ìä∏ -->
        <div class="flex overflow-x-auto space-x-4 pb-4 scrollbar-hide">
            <div th:each="item : ${weather.shortTermForecasts}"
                 class="min-w-[140px] bg-white/90 backdrop-blur-sm p-4 rounded-2xl shadow-lg border border-white/40 flex flex-col items-center justify-between hover:scale-105 transition duration-300">

                    <span class="text-gray-500 font-bold text-sm bg-gray-100 px-3 py-1 rounded-full mb-2">
                        <span th:text="${#strings.substring(item.fcstTime, 0, 2)}">12</span>:00
                    </span>

                <div class="text-4xl my-2 text-gray-600">
                    <i th:if="${item.PTY != '0'}" class="fas fa-umbrella text-blue-400 drop-shadow-sm"></i>
                    <i th:if="${item.PTY == '0' && item.SKY == '1'}" class="fas fa-sun text-yellow-400 drop-shadow-sm"></i>
                    <i th:if="${item.PTY == '0' && item.SKY == '3'}" class="fas fa-cloud-sun text-gray-400 drop-shadow-sm"></i>
                    <i th:if="${item.PTY == '0' && item.SKY == '4'}" class="fas fa-cloud text-gray-500 drop-shadow-sm"></i>
                </div>

                <div class="text-2xl font-bold text-gray-800 mb-1">
                    <span th:text="${item.T1H}"></span>¬∞
                </div>

                <!-- ÎÇôÎ¢∞ Ï£ºÏùò -->
                <div th:if="${item.LGT != '0' && item.LGT != '-100' && item.LGT != null}" class="text-xs font-bold text-red-500 bg-red-50 px-2 py-1 rounded flex items-center gap-1 mb-1 animate-pulse">
                    <i class="fas fa-bolt"></i> ÎÇôÎ¢∞Ï£ºÏùò
                </div>

                <div class="text-xs text-gray-400 text-center w-full border-t border-gray-200 pt-2 mt-2 space-y-1">
                    <div class="flex justify-between w-full">
                        <span><i class="fas fa-tint text-blue-300"></i></span>
                        <span th:text="${item.REH} + '%'"></span>
                    </div>
                    <div class="flex justify-between w-full">
                        <span><i class="fas fa-wind text-gray-300"></i></span>
                        <span th:text="${item.WSD} + 'm/s'"></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Í∑∏ÎûòÌîÑ ÏòÅÏó≠ -->
        <div class="bg-white/95 backdrop-blur-md p-6 rounded-3xl shadow-lg border border-white/50 mt-6">
            <h4 class="text-sm font-bold text-slate-500 mb-4 flex items-center">
                <i class="fas fa-chart-line mr-2 text-blue-500"></i>Í∏∞Ïò® Î∞è ÏäµÎèÑ Î≥ÄÌôî Ï∂îÏù¥
            </h4>
            <div class="relative h-64 w-full">
                <canvas id="weatherChart"></canvas>
            </div>
        </div>
    </div>


    <!-- 5. Sun/Moon Cycle ÌÉúÏñë/Îã¨Ïùò Ïù¥Îèô -->
    <div class="mb-10">
        <h3 class="text-xl font-bold text-white mb-4 px-1 flex items-center drop-shadow-md">
            <i class="fas" th:classappend="${weather.dayTime ? 'fa-sun text-yellow-300' : 'fa-moon text-blue-200'}"></i>
            <span class="ml-2" th:text="${weather.dayTime ? 'ÌÉúÏñëÏùò Ïù¥Îèô' : 'Îã¨Ïùò Ïù¥Îèô'}">ÌÉúÏñëÏùò Ïù¥Îèô</span>
        </h3>
        <div class="bg-gradient-to-br p-8 rounded-3xl shadow-2xl relative overflow-hidden text-center border border-white/10"
             th:classappend="${weather.dayTime ? 'from-indigo-900 to-slate-800' : 'from-slate-900 to-black'}">
            <!-- Î≥Ñ Î∞∞Í≤Ω Ìö®Í≥º -->
            <div class="absolute inset-0 opacity-30 pointer-events-none" style="background-image: radial-gradient(white 1px, transparent 1px); background-size: 20px 20px;"></div>

            <div class="relative z-10 flex flex-col items-center">
                <div class="w-full max-w-sm relative h-40 mb-2">
                    <!-- Î∞òÏõê Í∂§ÎèÑ SVG -->
                    <svg viewBox="0 0 100 50" class="w-full h-full overflow-visible">
                        <!-- Í∂§ÎèÑ Ìä∏Îûô -->
                        <path d="M 10 50 A 40 40 0 0 1 90 50" fill="none" stroke="rgba(255,255,255,0.2)" stroke-width="2" stroke-linecap="round" stroke-dasharray="4 4" />

                        <!-- ÏßÑÌñâ Î∞î (ÏßÑÌñâÎ•†Ïóê Îî∞Îùº Ï±ÑÏõåÏßê) -->
                        <path id="sunProgressPath" d="M 10 50 A 40 40 0 0 1 90 50" fill="none"
                              th:attr="stroke=${weather.dayTime ? 'url(#sunGradient)' : 'url(#moonGradient)'}"
                              stroke-width="4" stroke-linecap="round" class="sun-path" />

                        <!-- Í∑∏ÎùºÎç∞Ïù¥ÏÖò Ï†ïÏùò -->
                        <defs>
                            <linearGradient id="sunGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" style="stop-color:#FDB813;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#FF8C00;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="moonGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" style="stop-color:#E2E8F0;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#94A3B8;stop-opacity:1" />
                            </linearGradient>
                        </defs>

                        <!-- ÌÉúÏñë/Îã¨ ÏïÑÏù¥ÏΩò (JSÎ°ú ÏúÑÏπò Ïù¥Îèô) -->
                        <g id="sunIconGroup">
                            <circle cx="0" cy="0" r="3"
                                    th:attr="fill=${weather.dayTime ? '#FDB813' : '#E2E8F0'}, filter=${weather.dayTime ? 'drop-shadow(0 0 4px #FDB813)' : 'drop-shadow(0 0 4px #E2E8F0)'}" />
                            <text x="0" y="-6" text-anchor="middle" fill="white" font-size="3" font-weight="bold" id="sunTimeText">Now</text>
                        </g>
                    </svg>

                    <!-- ÏßÄÌèâÏÑ† -->
                    <div class="absolute bottom-0 left-0 w-full h-px bg-white/20"></div>
                </div>

                <!-- ÏùºÏ∂ú/ÏùºÎ™∞ ÏãúÍ∞Ñ ÌëúÏãú -->
                <div class="flex justify-between w-full max-w-sm px-2 text-white/90 text-sm font-medium">
                    <div class="text-left">
                        <p class="text-xs text-white/50 uppercase tracking-wider" th:text="${weather.dayTime ? 'Sunrise' : 'Moonrise'}">Sunrise</p>
                        <p class="text-lg font-bold text-yellow-300">
                            <i class="fas" th:classappend="${weather.dayTime ? 'fa-sun' : 'fa-moon'}"></i>
                            <span th:text="${weather.dayTime ? weather.sunrise : weather.sunset}">06:00</span>
                        </p>
                    </div>
                    <div class="text-right">
                        <p class="text-xs text-white/50 uppercase tracking-wider" th:text="${weather.dayTime ? 'Sunset' : 'Moonset'}">Sunset</p>
                        <p class="text-lg font-bold text-orange-400">
                            <span th:text="${weather.dayTime ? weather.sunset : weather.sunrise}">19:00</span>
                            <i class="fas" th:classappend="${weather.dayTime ? 'fa-moon' : 'fa-sun'}"></i>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- AI ÎÇ†Ïî® DJ Ïπ¥Îìú -->
    <div class="bg-black/80 backdrop-blur-md rounded-3xl p-6 shadow-2xl border border-gray-700 mb-10 text-white flex flex-col md:flex-row gap-6">
        <!-- Ïï®Î≤î ÏïÑÌä∏ / Ïú†ÌäúÎ∏å ÌîåÎ†àÏù¥Ïñ¥ -->
        <div class="w-full md:w-1/3 aspect-video md:aspect-square rounded-2xl overflow-hidden shadow-lg border border-gray-600 bg-black relative group">
            <iframe th:src="'https://www.youtube.com/embed/' + ${weather.youtubeVideoId} + '?autoplay=0&controls=1&showinfo=0&rel=0'"
                    title="YouTube video player" frameborder="0"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                    allowfullscreen
                    class="absolute inset-0 w-full h-full"></iframe>
        </div>

        <!-- DJ Î©òÌä∏ Î∞è Ï†ïÎ≥¥ -->
        <div class="flex-1 flex flex-col justify-center">
            <div class="flex items-center gap-2 mb-3">
                <span class="text-xs font-bold text-black bg-green-400 px-2 py-1 rounded-full uppercase tracking-wider">Now Playing</span>
                <h3 class="text-sm font-bold text-gray-400 uppercase tracking-widest"><i class="fas fa-headphones-alt mr-1"></i> AI Weather DJ</h3>
            </div>

            <h2 class="text-2xl font-bold mb-4 text-white">ÎÇ†Ïî®Ïóê Îî± ÎßûÎäî ÏÑ†Í≥° üéµ</h2>

            <div class="bg-white/10 p-5 rounded-2xl backdrop-blur-sm border border-white/10">
                <p class="text-lg font-light leading-relaxed text-gray-200">
                    "<span th:text="${weather.musicComment}">ÏùåÏïÖÏùÑ Í≥†Î•¥Îäî Ï§ëÏûÖÎãàÎã§...</span>"
                </p>
            </div>

            <div class="mt-4 flex gap-4 text-sm text-gray-500">
                <span class="flex items-center gap-1"><i class="fas fa-cloud"></i> ÎÇ†Ïî® Í∏∞Î∞ò Ï∂îÏ≤ú</span>
                <span class="flex items-center gap-1"><i class="fas fa-clock"></i> ÏãúÍ∞ÑÎåÄ Î∞òÏòÅ</span>
            </div>
        </div>
    </div>


    <!-- 6. ÎÇ¥Ïùº & Î™®Î†à ÎÇ†Ïî® (Í∑∏Î¶¨Îìú Î†àÏù¥ÏïÑÏõÉ) -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-10">
        <!-- (ÎÇ¥Ïùº ÎÇ†Ïî® ÏÉùÎûµ - Í∏∞Ï°¥ ÏΩîÎìú Ïú†ÏßÄ) -->
        <div class="flex flex-col h-full">
            <h3 class="text-xl font-bold text-white mb-4 px-1 flex items-center justify-between drop-shadow-md">
                <div class="flex items-center">
                    <i class="fas fa-calendar-day text-green-300 mr-2"></i>
                    <span class="mr-2">ÎÇ¥Ïùº ÎÇ†Ïî®</span>
                    <span class="text-xs font-normal text-gray-600 bg-white/90 px-2 py-1 rounded-full shadow-sm"
                          th:if="${weather.tomorrowFcstDate != null}"
                          th:text="${#strings.substring(weather.tomorrowFcstDate, 4, 6)} + 'Ïõî ' + ${#strings.substring(weather.tomorrowFcstDate, 6, 8)} + 'Ïùº'">
                        </span>
                </div>
                <!-- ÎÇ¥Ïùº ÏµúÏ†Ä/ÏµúÍ≥† Í∏∞Ïò® ÌëúÏãú -->
                <span class="text-sm font-medium text-white/90 bg-black/20 px-3 py-1 rounded-full backdrop-blur-sm shadow-sm"
                      th:if="${weather.tomorrowTMN != null && weather.tomorrowTMX != null}">
                        <i class="fas fa-temperature-low text-blue-300"></i> <span th:text="${weather.tomorrowTMN}"></span>¬∞
                        <span class="mx-1 opacity-50">/</span>
                        <i class="fas fa-temperature-high text-red-300"></i> <span th:text="${weather.tomorrowTMX}"></span>¬∞
                    </span>
            </h3>

            <div th:if="${#lists.isEmpty(weather.tomorrowForecasts)}" class="flex-1 flex flex-col justify-center items-center text-center py-12 bg-white/90 backdrop-blur-sm rounded-3xl shadow-lg">
                <i class="fas fa-hourglass-half mb-3 text-3xl text-gray-300"></i><br>
                <span class="text-gray-500 font-medium">ÎÇ¥Ïùº ÏòàÎ≥¥ Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ± Ï§ë...<br>(Ïò§ÌõÑ 5Ïãú Ïù¥ÌõÑ Ï†ïÌôïÌï¥ÏßëÎãàÎã§)</span>
            </div>

            <div th:unless="${#lists.isEmpty(weather.tomorrowForecasts)}" class="flex-1 flex overflow-x-auto space-x-4 pb-4 scrollbar-hide items-stretch">
                <div th:each="item : ${weather.tomorrowForecasts}" class="min-w-[120px] bg-white/90 backdrop-blur-sm p-4 rounded-2xl shadow-md border border-white/40 flex flex-col items-center justify-between hover:bg-white transition group h-full">
                        <span class="text-gray-500 font-bold text-xs bg-gray-100 px-2 py-1 rounded-full mb-2 group-hover:bg-green-100 group-hover:text-green-600 transition">
                            <span th:text="${#strings.substring(item.fcstTime, 0, 2)}">12</span>:00
                        </span>
                    <div class="text-2xl my-2 text-gray-600">
                        <i th:if="${item.PTY != '0'}" class="fas fa-umbrella text-blue-500"></i>
                        <i th:if="${item.PTY == '0' && item.SKY == '1'}" class="fas fa-sun text-yellow-400"></i>
                        <i th:if="${item.PTY == '0' && item.SKY == '3'}" class="fas fa-cloud-sun text-gray-400"></i>
                        <i th:if="${item.PTY == '0' && item.SKY == '4'}" class="fas fa-cloud text-gray-400"></i>
                    </div>
                    <div class="text-lg font-bold text-gray-800"><span th:text="${item.getTemp()}"></span>¬∞</div>
                    <div class="mt-auto pt-2 w-full text-center">
                        <div class="text-xs text-blue-500 font-bold bg-blue-50 px-2 py-0.5 rounded-full inline-block" th:if="${item.POP != '0'}">
                            <i class="fas fa-tint text-[10px] mr-1"></i><span th:text="${item.POP} + '%'"></span>
                        </div>
                        <div class="text-xs text-transparent font-bold px-2 py-0.5" th:unless="${item.POP != '0'}">-</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Î™®Î†à ÎÇ†Ïî® -->
        <div class="flex flex-col h-full">
            <h3 class="text-xl font-bold text-white mb-4 px-1 flex items-center justify-between drop-shadow-md">
                <div class="flex items-center">
                    <i class="fas fa-calendar-week text-purple-300 mr-2"></i>
                    <span class="mr-2">Î™®Î†à ÎÇ†Ïî®</span>
                    <span class="text-xs font-normal text-gray-600 bg-white/90 px-2 py-1 rounded-full shadow-sm"
                          th:if="${weather.dayAfterTomorrowFcstDate != null}"
                          th:text="${#strings.substring(weather.dayAfterTomorrowFcstDate, 4, 6)} + 'Ïõî ' + ${#strings.substring(weather.dayAfterTomorrowFcstDate, 6, 8)} + 'Ïùº'">
                        </span>
                </div>
                <!-- Î™®Î†à ÏµúÏ†Ä/ÏµúÍ≥† Í∏∞Ïò® ÌëúÏãú -->
                <span class="text-sm font-medium text-white/90 bg-black/20 px-3 py-1 rounded-full backdrop-blur-sm shadow-sm"
                      th:if="${weather.dayAfterTomorrowTMN != null && weather.dayAfterTomorrowTMX != null}">
                        <i class="fas fa-temperature-low text-blue-300"></i> <span th:text="${weather.dayAfterTomorrowTMN}"></span>¬∞
                        <span class="mx-1 opacity-50">/</span>
                        <i class="fas fa-temperature-high text-red-300"></i> <span th:text="${weather.dayAfterTomorrowTMX}"></span>¬∞
                    </span>
            </h3>

            <div th:if="${#lists.isEmpty(weather.dayAfterTomorrowForecasts)}" class="flex-1 flex flex-col justify-center items-center text-center py-12 bg-white/90 backdrop-blur-sm rounded-3xl shadow-lg">
                <i class="fas fa-hourglass-half mb-3 text-3xl text-gray-300"></i><br>
                <span class="text-gray-500 font-medium">Î™®Î†à ÏòàÎ≥¥ Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ± Ï§ë...</span>
            </div>

            <div th:unless="${#lists.isEmpty(weather.dayAfterTomorrowForecasts)}" class="flex-1 flex overflow-x-auto space-x-4 pb-4 scrollbar-hide items-stretch">
                <div th:each="item : ${weather.dayAfterTomorrowForecasts}" class="min-w-[120px] bg-white/90 backdrop-blur-sm p-4 rounded-2xl shadow-md border border-white/40 flex flex-col items-center justify-between hover:bg-white transition group h-full">
                        <span class="text-gray-500 font-bold text-xs bg-gray-100 px-2 py-1 rounded-full mb-2 group-hover:bg-purple-100 group-hover:text-purple-600 transition">
                            <span th:text="${#strings.substring(item.fcstTime, 0, 2)}">12</span>:00
                        </span>
                    <div class="text-2xl my-2 text-gray-600">
                        <i th:if="${item.PTY != '0'}" class="fas fa-umbrella text-blue-500"></i>
                        <i th:if="${item.PTY == '0' && item.SKY == '1'}" class="fas fa-sun text-yellow-400"></i>
                        <i th:if="${item.PTY == '0' && item.SKY == '3'}" class="fas fa-cloud-sun text-gray-400"></i>
                        <i th:if="${item.PTY == '0' && item.SKY == '4'}" class="fas fa-cloud text-gray-400"></i>
                    </div>
                    <div class="text-lg font-bold text-gray-800"><span th:text="${item.getTemp()}"></span>¬∞</div>
                    <div class="mt-auto pt-2 w-full text-center">
                        <div class="text-xs text-blue-500 font-bold bg-blue-50 px-2 py-0.5 rounded-full inline-block" th:if="${item.POP != '0'}">
                            <i class="fas fa-tint text-[10px] mr-1"></i><span th:text="${item.POP} + '%'"></span>
                        </div>
                        <div class="text-xs text-transparent font-bold px-2 py-0.5" th:unless="${item.POP != '0'}">-</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 7. Ïò§Îäò ÏÉÅÏÑ∏ Îç∞Ïù¥ÌÑ∞ (Í∑∏Î¶¨Îìú) -->
    <div class="mb-10">
        <!-- (Í∏∞Ï°¥ ÏÉÅÏÑ∏ Îç∞Ïù¥ÌÑ∞ ÏΩîÎìú Ïú†ÏßÄ) -->
        <h3 class="text-xl font-bold text-white mb-4 px-1 flex items-center drop-shadow-md">
            <i class="fas fa-chart-bar text-teal-300 mr-2"></i>Ïò§Îäò ÏÉÅÏÑ∏ ÎÇ†Ïî®
        </h3>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <div class="bg-white p-5 rounded-2xl shadow-sm border hover:shadow-md transition">
                <p class="text-xs text-gray-400 font-bold mb-1">Í∞ïÏàòÌôïÎ•†</p>
                <div class="text-2xl font-bold text-gray-800"><i class="fas fa-umbrella text-blue-400 mr-2"></i><span th:text="${weather.POP}">-</span>%</div>
            </div>
            <div class="bg-white p-5 rounded-2xl shadow-sm border hover:shadow-md transition">
                <p class="text-xs text-gray-400 font-bold mb-1">ÏäµÎèÑ</p>
                <div class="text-2xl font-bold text-gray-800"><i class="fas fa-tint text-indigo-400 mr-2"></i><span th:text="${weather.REH}">-</span>%</div>
            </div>
            <div class="bg-white p-5 rounded-2xl shadow-sm border hover:shadow-md transition">
                <p class="text-xs text-gray-400 font-bold mb-1">ÌíçÏÜç</p>
                <div class="text-2xl font-bold text-gray-800"><i class="fas fa-wind text-gray-400 mr-2"></i><span th:text="${weather.WSD}">-</span>m/s</div>
            </div>
            <div class="bg-white p-5 rounded-2xl shadow-sm border hover:shadow-md transition">
                <p class="text-xs text-gray-400 font-bold mb-1">ÌååÍ≥†</p>
                <div class="text-2xl font-bold text-gray-800"><i class="fas fa-water text-blue-600 mr-2"></i><span th:text="${weather.WAV}">-</span>M</div>
            </div>
            <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100">
                <p class="text-xs text-slate-400 font-bold uppercase mb-1">1ÏãúÍ∞Ñ Í∞ïÏàòÎüâ</p>
                <div class="text-lg font-bold text-slate-700"><span th:text="${weather.PCP}">-</span></div>
            </div>
            <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100">
                <p class="text-xs text-slate-400 font-bold uppercase mb-1">1ÏãúÍ∞Ñ Ï†ÅÏÑ§</p>
                <div class="text-lg font-bold text-slate-700"><span th:text="${weather.SNO}">-</span></div>
            </div>
            <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100">
                <p class="text-xs text-slate-400 font-bold uppercase mb-1">ÎèôÏÑúÎ∞îÎûå</p>
                <div class="text-lg font-bold text-slate-700"><span th:text="${weather.UUU}">-</span> m/s</div>
            </div>
            <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100">
                <p class="text-xs text-slate-400 font-bold uppercase mb-1">ÎÇ®Î∂ÅÎ∞îÎûå</p>
                <div class="text-lg font-bold text-slate-700"><span th:text="${weather.VVV}">-</span> m/s</div>
            </div>
        </div>
    </div>

    <!-- 8. ÏÉùÌôú Í∏∞ÏÉÅ ÏßÄÏàò -->
    <div class="mb-10">
        <h3 class="text-xl font-bold text-white mb-4 px-1 flex items-center drop-shadow-md">
            <i class="fas fa-heart text-pink-300 mr-2"></i>ÏÉùÌôú Î∞è ÎåÄÍ∏∞ Ï†ïÎ≥¥
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- ÏûêÏô∏ÏÑ† Ïπ¥Îìú -->
            <a href="https://www.weather.go.kr/w/theme/daily-life/life-index.do" target="_blank" class="block hover-card">
                <div class="bg-white/90 backdrop-blur-sm rounded-2xl p-6 shadow-md border border-orange-100/50 flex items-center justify-between hover:shadow-lg transition">
                    <div>
                        <div class="text-sm font-bold text-orange-500 mb-1 flex items-center gap-1"><i class="fas fa-sun"></i> ÏûêÏô∏ÏÑ† ÏßÄÏàò</div>
                        <div class="text-3xl font-bold text-gray-800 mb-2">
                            <span th:text="${weather.uvStage}">-</span>
                            <span class="text-lg text-gray-400 font-normal" th:text="'(' + ${weather.uvIndex} + ')'"></span>
                        </div>
                        <p class="text-sm text-gray-500 leading-tight" th:text="${weather.uvComment}">Ï†ïÎ≥¥ Î°úÎî©Ï§ë...</p>
                    </div>
                    <div class="text-5xl text-orange-200 opacity-50"><i class="fas fa-umbrella-beach"></i></div>
                </div>
            </a>

            <!-- ÎØ∏ÏÑ∏Î®ºÏßÄ Ïπ¥Îìú -->
            <a href="https://www.airkorea.or.kr/" target="_blank" class="block hover-card">
                <div class="bg-white/90 backdrop-blur-sm rounded-2xl p-6 shadow-md border border-gray-100/50 flex items-center justify-between hover:shadow-lg transition">
                    <div>
                        <div class="text-sm font-bold text-gray-600 mb-1 flex items-center gap-1"><i class="fas fa-smog"></i> ÎØ∏ÏÑ∏Î®ºÏßÄ(PM10)</div>
                        <div class="text-3xl font-bold text-gray-800 mb-2">
                            <span th:text="${weather.getGradeText(weather.pm10Grade)}">-</span>
                            <span class="text-lg text-gray-400 font-normal" th:text="'(' + ${weather.pm10Value} + '„éç/„é•)'"></span>
                        </div>
                        <p class="text-sm text-gray-500 leading-tight" th:text="${weather.dustComment}">ÎåÄÍ∏∞ Ï†ïÎ≥¥ ÏàòÏã† Ï§ë...</p>
                    </div>
                    <div class="text-5xl opacity-50"
                         th:classappend="${weather.pm10Grade == '1' ? 'text-blue-200' : (weather.pm10Grade == '2' ? 'text-green-200' : (weather.pm10Grade == '3' ? 'text-yellow-200' : 'text-red-200'))}">
                        <i class="fas fa-mask"></i>
                    </div>
                </div>
            </a>

            <!-- Î∂àÏæåÏßÄÏàò Ïπ¥Îìú -->
            <a href="https://www.weatheri.co.kr/useful/useful04.php" target="_blank" class="block hover-card">
                <div class="bg-white/90 backdrop-blur-sm rounded-2xl p-6 shadow-md border border-red-100/50 flex items-center justify-between hover:shadow-lg transition">
                    <div>
                        <div class="text-sm font-bold text-red-500 mb-1 flex items-center gap-1"><i class="fas fa-tired"></i> Î∂àÏæåÏßÄÏàò</div>
                        <div class="text-3xl font-bold text-gray-800 mb-2">
                            <span th:text="${weather.discomfortStage}">-</span>
                            <span class="text-lg text-gray-400 font-normal" th:text="'(' + ${weather.discomfortIndex} + ')'"></span>
                        </div>
                        <p class="text-sm text-gray-500 leading-tight" th:text="${weather.discomfortComment}">Í≥ÑÏÇ∞ Ï§ë...</p>
                    </div>
                    <div class="text-5xl text-red-200 opacity-50"><i class="fas fa-temperature-arrow-up"></i></div>
                </div>
            </a>

            <!-- ÍΩÉÍ∞ÄÎ£® ÎÜçÎèÑ ÏúÑÌóòÏßÄÏàò Ïπ¥Îìú -->
            <a href="http://www.nims.go.kr/?sub_num=1033" target="_blank" class="block hover-card">
                <div class="bg-white/90 backdrop-blur-sm rounded-2xl p-6 shadow-md border border-green-100/50 flex items-center justify-between hover:shadow-lg transition">
                    <div>
                        <div class="text-sm font-bold text-green-600 mb-1 flex items-center gap-1"><i class="fas fa-tree"></i> ÍΩÉÍ∞ÄÎ£® ÎÜçÎèÑ</div>

                        <!-- Í≥ÑÏ†àÏóê Îî∞Îùº ÌëúÏãúÎêòÎäî Ï†ïÎ≥¥Í∞Ä Îã§Î¶Ñ -->
                        <div class="text-3xl font-bold text-gray-800 mb-2" th:if="${weather.oakPollenRisk != null}">
                            <span th:text="${weather.getPollenRiskText(weather.oakPollenRisk)}"></span>
                            <span class="text-xs font-normal text-gray-400 block mt-1">(Ï∞∏ÎÇòÎ¨¥ Í∏∞Ï§Ä)</span>
                        </div>
                        <div class="text-3xl font-bold text-gray-800 mb-2" th:if="${weather.weedsPollenRisk != null}">
                            <span th:text="${weather.getPollenRiskText(weather.weedsPollenRisk)}"></span>
                            <span class="text-xs font-normal text-gray-400 block mt-1">(Ïû°Ï¥àÎ•ò Í∏∞Ï§Ä)</span>
                        </div>
                        <div class="text-xl font-bold text-gray-400 mb-2" th:if="${weather.oakPollenRisk == null && weather.weedsPollenRisk == null}">
                            Ï†úÍ≥µÍ∏∞Í∞Ñ ÏïÑÎãò
                        </div>

                        <p class="text-sm text-gray-500 leading-tight" th:text="${weather.pollenComment}">Îç∞Ïù¥ÌÑ∞ ÌôïÏù∏ Ï§ë...</p>
                    </div>
                    <div class="text-5xl text-green-200 opacity-50"><i class="fas fa-seedling"></i></div>
                </div>
            </a>


        </div>
    </div>

    <!-- 9. Ïû¨ÎÇú ÏïàÏ†Ñ ÏÉÅÌô©Ïã§ -->
    <div class="mb-10">
        <h3 class="text-xl font-bold text-white mb-4 px-1 flex items-center drop-shadow-md">
            <i class="fas fa-shield-alt text-red-400 mr-2 animate-pulse"></i>Ïû¨ÎÇú ÏïàÏ†Ñ Î∏åÎ¶¨Ìïë (AI Î∂ÑÏÑù)
        </h3>
        <div class="grid grid-cols-1 gap-4">

            <!-- Í∏∞ÏÉÅÌäπÎ≥¥ -->
            <div th:if="${weather.hasWarning}" class="bg-red-50/95 backdrop-blur-sm border-l-8 border-red-500 p-6 rounded-r-2xl shadow-md flex items-start gap-5 animate-pulse">
                <div class="text-4xl text-red-500 mt-1"><i class="fas fa-exclamation-triangle"></i></div>
                <div>
                    <h4 class="text-xl font-bold text-red-700 mb-2">Í∏∞ÏÉÅÌäπÎ≥¥ Î∞úÌö® Ï§ë</h4>
                    <p class="text-red-600 whitespace-pre-line leading-relaxed font-medium" th:text="${weather.warningMsg}"></p>
                </div>
            </div>

            <!-- ÏßÄÏßÑ Ï†ïÎ≥¥ -->
            <div th:if="${weather.hasEarthquake}" class="bg-yellow-50/95 backdrop-blur-sm border-l-8 border-yellow-500 p-6 rounded-r-2xl shadow-md flex items-start gap-5">
                <div class="text-4xl text-yellow-600 mt-1"><i class="fas fa-rss"></i></div>
                <div class="flex-1">
                    <div class="flex justify-between items-center mb-2">
                        <h4 class="text-xl font-bold text-yellow-800">ÏµúÍ∑º ÏßÄÏßÑ Ï†ïÎ≥¥ (Í±∞Î¶¨: <span th:text="${weather.eqDist}"></span>)</h4>
                        <span class="text-sm text-yellow-700 font-bold bg-yellow-200/50 px-2 py-1 rounded" th:text="${weather.eqTime}"></span>
                    </div>
                    <div class="flex items-center gap-3 mb-2">
                        <span class="bg-yellow-200 text-yellow-800 px-2 py-0.5 rounded text-sm font-bold">Í∑úÎ™® <span th:text="${weather.eqMag}"></span></span>
                        <span class="text-yellow-800 font-medium text-lg" th:text="${weather.eqLoc}"></span>
                    </div>
                    <div class="bg-white/50 p-3 rounded-lg border border-yellow-200 mb-3">
                        <p class="text-sm font-bold text-yellow-900 flex items-center">
                            <i class="fas fa-robot mr-2"></i>AI ÏïàÏ†Ñ Î∂ÑÏÑù:
                            <span class="font-normal ml-1" th:text="${weather.eqSafetyMsg}"></span>
                        </p>
                    </div>
                    <a href="/earthquake" class="text-sm text-yellow-800 hover:text-yellow-950 font-bold underline inline-block transition">
                        <i class="fas fa-list-ul mr-1"></i> Ï†ÑÏ≤¥ Î™©Î°ù Î≥¥Í∏∞
                    </a>
                </div>
            </div>

            <!-- ÌÉúÌíç Ï†ïÎ≥¥ (Í±∞Î¶¨ ÌëúÏãú Ï∂îÍ∞Ä) -->
            <div th:if="${weather.hasTyphoon}" class="bg-blue-50/95 backdrop-blur-sm border-l-8 border-blue-500 p-6 rounded-r-2xl shadow-md flex items-start gap-5">
                <div class="text-4xl text-blue-600 mt-1"><i class="fas fa-hurricane animate-spin-slow"></i></div>
                <div class="flex-1">
                    <div class="flex justify-between items-center mb-2">
                        <h4 class="text-xl font-bold text-blue-800">ÌÉúÌíç ÌôúÎèô Ï§ë (Í±∞Î¶¨: <span th:text="${weather.typhoonDist}"></span>)</h4>
                        <span class="text-sm text-blue-700 font-bold bg-blue-200/50 px-2 py-1 rounded" th:text="${weather.typhoonTime}"></span>
                    </div>
                    <p class="text-blue-800 font-extrabold text-2xl mb-1" th:text="${weather.typhoonName}"></p>
                    <p class="text-blue-600 text-sm mb-3 font-medium" th:text="${weather.typhoonStatus}"></p>

                    <div class="bg-white/50 p-3 rounded-lg border border-blue-200 mb-3">
                        <p class="text-sm font-bold text-blue-900 flex items-center">
                            <i class="fas fa-robot mr-2"></i>AI ÏïàÏ†Ñ Î∂ÑÏÑù:
                            <span class="font-normal ml-1" th:text="${weather.typhoonSafetyMsg}"></span>
                        </p>
                    </div>
                    <a href="/typhoon" class="text-sm text-blue-800 hover:text-blue-950 font-bold underline inline-block transition">
                        <i class="fas fa-map mr-1"></i> Ï†ÑÏ≤¥ Í≤ΩÎ°ú ÌôïÏù∏ÌïòÍ∏∞
                    </a>
                </div>
            </div>

            <!-- ÏïàÏ†ÑÌï† Îïå ÌëúÏãú -->
            <div th:if="${!weather.hasWarning && !weather.hasTyphoon && !weather.hasEarthquake}" class="bg-green-50/90 backdrop-blur-sm border-l-8 border-green-500 p-6 rounded-r-2xl shadow-md">
                <div class="flex items-start gap-5">
                    <div class="text-4xl text-green-500 mt-1"><i class="fas fa-shield-check"></i></div>
                    <div class="flex-1">
                        <h4 class="text-xl font-bold text-green-700 mb-1">Ïû¨ÎÇú ÏïàÏ†Ñ ÏÉÅÌÉú 'ÏñëÌò∏'</h4>
                        <p class="text-green-600 font-medium mb-4">ÌòÑÏû¨ ÏÇ¨Ïö©Ïûê ÏúÑÏπò Ï£ºÎ≥ÄÏóê Ï£ºÏöî ÏúÑÌóò ÏöîÏÜåÍ∞Ä ÏóÜÏäµÎãàÎã§.</p>

                        <!-- ÏßÄÎÇú Í∏∞Î°ù Î∞îÎ°úÍ∞ÄÍ∏∞ Î≤ÑÌäº Ï∂îÍ∞Ä -->
                        <div class="flex flex-wrap gap-3">
                            <a href="/earthquake" class="inline-flex items-center text-sm font-bold text-green-700 bg-white/60 px-4 py-2 rounded-lg hover:bg-white transition shadow-sm border border-green-200/50">
                                <i class="fas fa-rss mr-2"></i>ÏßÄÎÇú ÏßÄÏßÑ Í∏∞Î°ù
                            </a>
                            <a href="/typhoon" class="inline-flex items-center text-sm font-bold text-green-700 bg-white/60 px-4 py-2 rounded-lg hover:bg-white transition shadow-sm border border-green-200/50">
                                <i class="fas fa-wind mr-2"></i>ÏßÄÎÇú ÌÉúÌíç Í∏∞Î°ù
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ÌïòÎã® ÏÉàÎ°úÍ≥†Ïπ® Î≤ÑÌäº -->
    <button onclick="location.reload()" class="w-full bg-white/20 hover:bg-white/30 backdrop-blur-md text-white font-bold py-4 rounded-xl shadow-lg transition border border-white/50 active:scale-[0.98] duration-200">
        <i class="fas fa-sync-alt mr-2 animate-spin-slow-on-hover"></i> Ï†ÑÏ≤¥ Îç∞Ïù¥ÌÑ∞ ÏÉàÎ°úÍ≥†Ïπ®
    </button>

    <!-- Ìë∏ÌÑ∞ -->
    <div class="mt-8 pb-8 text-center text-white/60 text-xs font-light">
        <p class="mb-1">Îç∞Ïù¥ÌÑ∞ Ï∂úÏ≤ò: Í≥µÍ≥µÎç∞Ïù¥ÌÑ∞Ìè¨ÌÑ∏ (Í∏∞ÏÉÅÏ≤≠ API, ÏóêÏñ¥ÏΩîÎ¶¨ÏïÑ)</p>
        <p>AI Analysis Powered by Python & Scikit-learn</p>
    </div>

    <!-- Îß® ÏúÑÎ°ú Í∞ÄÍ∏∞ Î≤ÑÌäº -->
    <button id="backToTopBtn" onclick="scrollToTop()"
            class="fixed bottom-8 right-8 z-50 bg-indigo-600 hover:bg-indigo-700 text-white w-12 h-12 rounded-full shadow-xl flex items-center justify-center cursor-pointer transition-all duration-300 opacity-0 translate-y-10 pointer-events-none hover:-translate-y-1">
        <i class="fas fa-arrow-up"></i>
    </button>

</div>

<!-- [Ïä§ÌÅ¨Î¶ΩÌä∏] Chart.js Í∑∏ÎûòÌîÑ ÏÉùÏÑ± Î°úÏßÅ -->
<script th:inline="javascript">
    function speakBriefing() {
        const text = document.getElementById('aiBriefingText').innerText;
        if (!text) {
            alert('ÏùΩÏñ¥Ï§Ñ Î∏åÎ¶¨Ìïë ÎÇ¥Ïö©Ïù¥ ÏóÜÏäµÎãàÎã§.');
            return;
        }
        const speech = new SpeechSynthesisUtterance();
        speech.text = text;
        speech.lang = 'ko-KR';
        speech.rate = 1.0;
        speech.pitch = 1.0;
        speech.volume = 1.0;
        const voices = window.speechSynthesis.getVoices();
        const koVoice = voices.find(v => v.lang.includes('ko') || v.name.includes('Google ÌïúÍµ≠Ïñ¥'));
        if (koVoice) {
            speech.voice = koVoice;
        }
        window.speechSynthesis.cancel();
        window.speechSynthesis.speak(speech);
    }

    // AI Îß§ÎãàÏ†Ä Ï†ëÍ∏∞/ÌéºÏπòÍ∏∞ Í∏∞Îä•
    function toggleAiManager() {
        const content = document.getElementById('aiManagerContent');
        const icon = document.getElementById('aiToggleIcon');

        // ÌòÑÏû¨ max-heightÍ∞Ä 0Ïù∏ÏßÄ(Ï†ëÌûå ÏÉÅÌÉúÏù∏ÏßÄ) ÌôïÏù∏ÌïòÎäî Î°úÏßÅ
        // Tailwind ÌÅ¥ÎûòÏä§ ÌÜ†Í∏Ä Î∞©Ïãù ÏÇ¨Ïö©
        if (content.classList.contains('max-h-0')) {
            // ÌéºÏπòÍ∏∞
            content.classList.remove('max-h-0', 'opacity-0');
            content.classList.add('max-h-[1000px]', 'opacity-100');
            icon.classList.remove('rotate-180');
        } else {
            // Ï†ëÍ∏∞
            content.classList.remove('max-h-[1000px]', 'opacity-100');
            content.classList.add('max-h-0', 'opacity-0');
            icon.classList.add('rotate-180');
        }
    }

    // Îß® ÏúÑÎ°ú Í∞ÄÍ∏∞ Î≤ÑÌäº Î°úÏßÅ
    const backToTopBtn = document.getElementById('backToTopBtn');

    window.addEventListener('scroll', () => {
        if (window.scrollY > 300) {
            backToTopBtn.classList.remove('opacity-0', 'translate-y-10', 'pointer-events-none');
            backToTopBtn.classList.add('opacity-100', 'translate-y-0');
        } else {
            backToTopBtn.classList.add('opacity-0', 'translate-y-10', 'pointer-events-none');
            backToTopBtn.classList.remove('opacity-100', 'translate-y-0');
        }
    });
    function scrollToTop() {
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // ÌÉúÏñë ÏïÑÏù¥ÏΩò ÏúÑÏπò ÏóÖÎç∞Ïù¥Ìä∏ Ìï®Ïàò
    function updateSunPosition() {
        // Thymeleaf Î≥ÄÏàò Ï£ºÏûÖ (ÏÑúÎ≤ÑÏóêÏÑú Í≥ÑÏÇ∞Îêú ÏßÑÌñâÎ•†)
        /*[# th:if="${weather.sunProgress != null}"]*/
        let progress = /*[[${weather.sunProgress}]]*/ 0;
        /*[/]*/
        /*[# th:unless="${weather.sunProgress != null}"]*/
        let progress = 0;
        /*[/]*/

        const pathLength = 251.2; // Circumference of semicircle r=40
        const offset = pathLength - (pathLength * (progress / 100));

        // 1. ÌîÑÎ°úÍ∑∏Î†àÏä§ Î∞î Ï±ÑÏö∞Í∏∞
        const progressPath = document.getElementById('sunProgressPath');
        if (progressPath) {
            progressPath.style.strokeDashoffset = offset;
        }

        // 2. ÏïÑÏù¥ÏΩò Ïù¥Îèô (SVG Path Ï¢åÌëú Í≥ÑÏÇ∞)
        // Path: M 10 50 A 40 40 0 0 1 90 50
        // Center: (50, 50), Radius: 40
        // Angle goes from 180 deg (left) to 0 deg (right)
        // Progress 0% -> 180 deg, 100% -> 0 deg

        const angleDeg = 180 - (180 * (progress / 100));
        const angleRad = angleDeg * (Math.PI / 180);

        // x = cx + r * cos(a), y = cy - r * sin(a) (SVG y is down, so minus for up)
        const cx = 50;
        const cy = 50;
        const r = 40;

        const x = cx + r * Math.cos(angleRad); // cos(180)=-1 -> x=10
        const y = cy - r * Math.sin(angleRad); // sin(180)=0 -> y=50, sin(90)=1 -> y=10

        const sunGroup = document.getElementById('sunIconGroup');
        if (sunGroup) {
            sunGroup.style.transition = "transform 2s ease-out";
            sunGroup.style.transformBox = "view-box"; // SVG Ï¢åÌëúÍ≥Ñ Í∏∞Ï§Ä
            // transform ÏÜçÏÑ±ÏùÑ ÏßÅÏ†ë Î≥ÄÍ≤ΩÌïòÍ±∞ÎÇò, x/y Ï¢åÌëúÎ•º Î≥ÄÍ≤ΩÌïòÏßÄ ÏïäÍ≥† translate ÏÇ¨Ïö©
            // ÌïòÏßÄÎßå SVG transformÏùÄ originÏù¥ Ï§ëÏöîÌï®.
            // Í∞ÑÎã®ÌïòÍ≤åÎäî JSÎ°ú translate Î¨∏ÏûêÏó¥ ÏÉùÏÑ±
            // Ï¥àÍ∏∞ ÏúÑÏπòÍ∞Ä 0,0 Ïù¥ÎØÄÎ°ú x,y ÎßåÌÅº Ïù¥Îèô

            // Ïï†ÎãàÎ©îÏù¥ÏÖòÏùÑ ÏúÑÌï¥ setTimeout ÏÇ¨Ïö©
            setTimeout(() => {
                sunGroup.setAttribute("transform", `translate(${x}, ${y})`);
            }, 100);
        }
    }

    // Ï∞®Ìä∏ Î∞è ÏùåÏÑ± Ìï©ÏÑ± Ï¥àÍ∏∞Ìôî
    document.addEventListener("DOMContentLoaded", function() {
        window.speechSynthesis.getVoices();

        // Sun Position Update
        updateSunPosition();

        const ctx = document.getElementById('weatherChart');
        if (!ctx) return;
        const labels = [];
        const tempPoints = [];
        const humidityPoints = [];
        /*[# th:each="item : ${weather.shortTermForecasts}"]*/
            labels.push(/*[[${#strings.substring(item.fcstTime, 0, 2)} + ':00']]*/ "12:00");
            tempPoints.push(/*[[${item.T1H}]]*/ 20);
            humidityPoints.push(/*[[${item.REH}]]*/ 50);
        /*[/]*/
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: 'Í∏∞Ïò® (¬∞C)',
                        data: tempPoints,
                        borderColor: '#3b82f6',
                        backgroundColor: '#3b82f6',
                        yAxisID: 'y',
                        tension: 0.4,
                        borderWidth: 3,
                        pointRadius: 4,
                        pointBackgroundColor: '#fff',
                        pointBorderWidth: 2
                    },
                    {
                        label: 'ÏäµÎèÑ (%)',
                        data: humidityPoints,
                        borderColor: '#a855f7',
                        backgroundColor: 'rgba(168, 85, 247, 0.1)',
                        yAxisID: 'y1',
                        tension: 0.4,
                        borderWidth: 2,
                        borderDash: [5, 5],
                        pointRadius: 3,
                        fill: true
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: { mode: 'index', intersect: false },
                plugins: {
                    legend: { position: 'top', align: 'end', labels: { usePointStyle: true, boxWidth: 8, font: { family: "'Noto Sans KR', sans-serif" } } },
                    tooltip: {
                        backgroundColor: 'rgba(255, 255, 255, 0.9)',
                        titleColor: '#1e293b',
                        bodyColor: '#1e293b',
                        borderColor: '#e2e8f0',
                        borderWidth: 1,
                        padding: 10,
                        bodyFont: { family: "'Noto Sans KR', sans-serif" },
                        callbacks: {
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) label += ': ';
                                if (context.parsed.y !== null) label += context.parsed.y;
                                return label;
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        type: 'linear',
                        display: true,
                        position: 'left',
                        title: { display: true, text: 'Í∏∞Ïò® (¬∞C)', color: '#3b82f6', font: {size: 11, weight: 'bold'} },
                        grid: { color: '#f1f5f9' },
                        ticks: { color: '#3b82f6' }
                    },
                    y1: {
                        type: 'linear',
                        display: true,
                        position: 'right',
                        title: { display: true, text: 'ÏäµÎèÑ (%)', color: '#a855f7', font: {size: 11, weight: 'bold'} },
                        grid: { display: false },
                        min: 0,
                        max: 100,
                        ticks: { color: '#a855f7' }
                    },
                    x: { grid: { display: false }, ticks: { color: '#64748b' } }
                }
            }
        });
    });

    const modal = document.getElementById('predictModal');
    const iframe = document.getElementById('predictFrame');

    // Î™®Îã¨ Ïó¥Í∏∞ Ìï®Ïàò
    function openModal() {
        modal.classList.remove('hidden');
        document.body.style.overflow = 'hidden';

        // iframe ÎÇ¥Î∂ÄÏùò resetAll Ìï®Ïàò Ìò∏Ï∂ú (ÏÉàÎ°úÍ≥†Ïπ® ÏóÜÏù¥ Í∞íÎßå Ï¥àÍ∏∞Ìôî)
        if (iframe && iframe.contentWindow.resetAll) {
            iframe.contentWindow.resetAll();
        }
    }
    // Î™®Îã¨ Îã´Í∏∞ Ìï®Ïàò
    function closeModal() {
        modal.classList.add('hidden');
        document.body.style.overflow = 'auto';

        // Îã´ÏùÑ ÎïåÎèÑ ÎØ∏Î¶¨ ÎπÑÏõåÎëêÎ©¥ Îã§ÏùåÏóê Ïó¥ Îïå Îçî ÍπîÎÅîÌï©ÎãàÎã§.
        if (iframe && iframe.contentWindow.resetAll) {
            iframe.contentWindow.resetAll();
        }
    }

    window.onkeydown = function(event) {
        if (event.key === "Escape" && !modal.classList.contains('hidden')) {
            closeModal();
        }
    };
</script>
</body>
</html>