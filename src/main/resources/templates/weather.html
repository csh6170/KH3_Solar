<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¢…í•© ë‚ ì”¨ ì •ë³´ êµ¬ë¼ì„</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js (ê·¸ë˜í”„ìš©) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- FontAwesome (ì•„ì´ì½˜) -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        /* ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¹€ ì²˜ë¦¬ */
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        /* ë°°ê²½ ì´ë¯¸ì§€ ë³€ê²½ ì‹œ ë¶€ë“œëŸ¬ìš´ ì „í™˜ íš¨ê³¼ */
        .bg-transition { transition: background-image 0.5s ease-in-out; }
    </style>
</head>

<!-- [í•µì‹¬] ë°°ê²½ ì´ë¯¸ì§€ ë™ì  ë°”ì¸ë”© & ë°°ê²½ ì„¤ì • -->
<body class="min-h-screen p-4 md:p-8 bg-cover bg-center bg-fixed bg-no-repeat bg-transition"
      th:style="'background-image: url(' + ${weather.bgImageUrl} + ');'">

<!-- ë°°ê²½ ì˜¤ë²„ë ˆì´ (ê²€ì€ìƒ‰ 30% íˆ¬ëª…ë„) - ê¸€ì ê°€ë…ì„±ì„ ìœ„í•´ í•„ìˆ˜ -->
<div class="fixed inset-0 bg-black/30 z-0 pointer-events-none"></div>

<!-- ë©”ì¸ ì»¨í…ì¸  ë˜í¼ (z-indexë¥¼ ì£¼ì–´ ì˜¤ë²„ë ˆì´ ìœ„ë¡œ ì˜¬ë¦¼) -->
<div class="max-w-5xl mx-auto relative z-10">

    <!-- 1. ìƒë‹¨ í—¤ë” & ì§€ì—­ ì„ íƒ -->
    <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
        <div>
            <h1 class="text-3xl font-bold text-white drop-shadow-md">
                <i class="fas fa-satellite-dish text-blue-300 mr-2"></i>ê¸°ìƒì²­ ì˜ˆë³´ ëŒ€ì‹œë³´ë“œ
            </h1>
            <p class="text-white/90 text-sm mt-1 drop-shadow-sm font-medium">
                ë°œí‘œ: <span th:text="${weather.baseDate} + ' ' + ${weather.baseTime}"></span>
            </p>
        </div>

        <button onclick="openModal()"
                class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 px-8 rounded-2xl shadow-lg transition transform hover:scale-105 flex items-center gap-3">
            <i class="fas fa-solar-panel"></i>
            <span>íƒœì–‘ê´‘ ë°œì „ ì˜ˆì¸¡í•˜ê¸°</span>
        </button>

        <div id="predictModal" class="fixed inset-0 z-50 hidden overflow-y-auto">
            <div class="flex items-center justify-center min-h-screen p-4 text-center">
                <div class="fixed inset-0 bg-black opacity-50 transition-opacity" onclick="closeModal()"></div>

                <div class="relative bg-white rounded-3xl overflow-hidden shadow-2xl transform transition-all max-w-lg w-full z-50">

                    <button onclick="closeModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 z-[60]">
                        <i class="fas fa-times text-xl"></i>
                    </button>

                    <iframe src="/predict-form"
                            class="w-full h-[900px] border-none"
                            id="predictFrame">
                    </iframe>
                </div>
            </div>
        </div>

        <div class="relative w-full md:w-64">
            <select onchange="const c=this.value.split(','); location.href='/?nx='+c[0]+'&ny='+c[1]"
                    class="w-full p-3 rounded-xl border-none bg-white/80 backdrop-blur-md font-bold text-gray-700 shadow-lg focus:ring-2 focus:ring-blue-400 outline-none cursor-pointer hover:bg-white/90 transition">
                <option th:each="region : ${regions}"
                        th:value="${region.nx} + ',' + ${region.ny}"
                        th:text="${region.name}"
                        th:selected="${region.nx == currentNx && region.ny == currentNy}">ì§€ì—­</option>
            </select>
            <div class="absolute inset-y-0 right-0 flex items-center px-4 pointer-events-none text-gray-600">
                <i class="fas fa-map-marker-alt"></i>
            </div>
        </div>
    </div>

    <!-- 2. ë©”ì¸ ë‚ ì”¨ ì¹´ë“œ (ê¸€ë˜ìŠ¤ëª¨í”¼ì¦˜ ì ìš©) -->
    <div class="bg-white/90 backdrop-blur-md rounded-3xl p-8 text-gray-800 shadow-2xl mb-6 flex flex-col md:flex-row items-center justify-between border border-white/50">
        <div class="text-center md:text-left">
            <h2 class="text-2xl font-bold mb-2 text-gray-700 flex items-center justify-center md:justify-start gap-2">
                <i class="fas fa-location-dot text-blue-500"></i>
                <span th:text="${currentRegionName}">ì§€ì—­ëª…</span>
            </h2>
            <div class="text-7xl font-extrabold mb-2 text-gray-900 tracking-tight">
                <span th:text="${weather.TMP}">-</span><span class="text-4xl align-top">Â°</span>
            </div>
            <p class="text-xl font-medium text-gray-600">
                <span th:text="${weather.SKY}">-</span>
                <span th:if="${weather.PTY != 'ê°•ìˆ˜ì—†ìŒ'}" th:text="'/ ' + ${weather.PTY}"></span>
            </p>
            <div class="mt-6 flex gap-4 text-sm bg-gray-100/80 p-3 rounded-xl inline-flex shadow-inner">
                <span class="flex items-center gap-1"><i class="fas fa-temperature-low text-blue-500"></i> ìµœì € <span th:text="${weather.TMN != null ? weather.TMN : '-'}"></span>Â°</span>
                <span class="w-px h-4 bg-gray-300"></span>
                <span class="flex items-center gap-1"><i class="fas fa-temperature-high text-red-500"></i> ìµœê³  <span th:text="${weather.TMX != null ? weather.TMX : '-'}"></span>Â°</span>
            </div>
        </div>

        <!-- ë‚ ì”¨ ì•„ì´ì½˜ (ì• ë‹ˆë©”ì´ì…˜ & ê·¸ë¦¼ì ê°•í™”) -->
        <div class="mt-8 md:mt-0 transform hover:scale-110 transition duration-300">
            <i th:if="${weather.PTY == 'ë¹„'}" class="fas fa-cloud-showers-heavy text-9xl text-blue-500 animate-bounce drop-shadow-xl"></i>
            <i th:if="${weather.PTY == 'ëˆˆ'}" class="fas fa-snowflake text-9xl text-sky-300 animate-spin-slow drop-shadow-xl"></i>
            <i th:if="${weather.PTY == 'ë¹„/ëˆˆ'}" class="fas fa-cloud-meatball text-9xl text-gray-400 animate-pulse drop-shadow-xl"></i>
            <i th:if="${weather.PTY == 'ì†Œë‚˜ê¸°'}" class="fas fa-cloud-showers-water text-9xl text-blue-600 animate-bounce drop-shadow-xl"></i>
            <i th:if="${weather.PTY == 'ë¹—ë°©ìš¸'}" class="fas fa-cloud-rain text-9xl text-blue-400 animate-pulse drop-shadow-xl"></i>
            <i th:if="${weather.PTY == 'ê°•ìˆ˜ì—†ìŒ' && weather.SKY == 'ë§‘ìŒ'}" class="fas fa-sun text-9xl text-yellow-400 animate-pulse drop-shadow-[0_0_15px_rgba(250,204,21,0.6)]"></i>
            <i th:if="${weather.PTY == 'ê°•ìˆ˜ì—†ìŒ' && weather.SKY == 'êµ¬ë¦„ë§ìŒ'}" class="fas fa-cloud-sun text-9xl text-gray-400 drop-shadow-xl"></i>
            <i th:if="${weather.PTY == 'ê°•ìˆ˜ì—†ìŒ' && weather.SKY == 'íë¦¼'}" class="fas fa-cloud text-9xl text-gray-500 drop-shadow-xl"></i>
        </div>
    </div>

    <!-- 3. AI ê¸°ìƒ ìºìŠ¤í„° ë¸Œë¦¬í•‘ (ë¬´ë£Œ TTS ì ìš©) -->
    <div class="bg-white/95 backdrop-blur-md rounded-3xl p-6 shadow-xl border-l-8 border-indigo-500 mb-8 flex flex-col md:flex-row gap-6 relative overflow-hidden">
        <div class="flex-shrink-0 flex flex-col items-center justify-center min-w-[100px]">
            <div class="w-20 h-20 rounded-full bg-indigo-100 flex items-center justify-center text-4xl mb-2 shadow-inner border-2 border-indigo-200">
                <span class="animate-bounce" style="animation-duration: 2s;">ğŸ‘©â€ğŸ’¼</span>
            </div>
            <span class="text-xs font-extrabold text-indigo-600 uppercase tracking-widest bg-indigo-50 px-2 py-1 rounded-full">AI Caster</span>
        </div>
        <div class="flex-1 z-10 py-2">
            <div class="flex justify-between items-center mb-3">
                <h3 class="text-lg font-bold text-gray-800 flex items-center">
                    AI ë‚ ì”¨ ë¸Œë¦¬í•‘ <span class="ml-3 text-[10px] font-bold text-white bg-red-500 px-2 py-0.5 rounded-full animate-pulse shadow-sm">LIVE ON AIR</span>
                </h3>

                <!-- TTS ë“£ê¸° ë²„íŠ¼ -->
                <button onclick="speakBriefing()" class="flex items-center gap-2 bg-indigo-100 text-indigo-700 px-4 py-2 rounded-full text-sm font-bold hover:bg-indigo-200 transition active:scale-95">
                    <i class="fas fa-volume-up"></i> ë‚ ì”¨ ë“£ê¸°
                </button>
            </div>

            <div class="bg-gray-50 p-5 rounded-2xl text-gray-700 leading-relaxed font-medium border border-gray-200 shadow-inner relative">
                <i class="fas fa-quote-left text-gray-300 absolute top-3 left-3"></i>
                <!-- id="aiBriefingText" ì¶”ê°€í•˜ì—¬ ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì½ì„ ìˆ˜ ìˆê²Œ í•¨ -->
                <span id="aiBriefingText" class="px-6 block" th:text="${weather.aiBriefing}">ìºìŠ¤í„°ê°€ ëŒ€ë³¸ì„ ì¤€ë¹„ì¤‘ì…ë‹ˆë‹¤...</span>
                <i class="fas fa-quote-right text-gray-300 absolute bottom-3 right-3"></i>
            </div>
        </div>
    </div>

    <!-- 4. í–¥í›„ 6ì‹œê°„ ìƒì„¸ ì˜ˆë³´ (ì°¨íŠ¸ í¬í•¨) -->
    <div class="mb-8">
        <h3 class="text-xl font-bold text-white mb-4 px-1 flex items-center drop-shadow-md">
            <i class="fas fa-history text-blue-300 mr-2"></i>í–¥í›„ 6ì‹œê°„ ì˜ˆë³´
        </h3>

        <!-- ê°€ë¡œ ìŠ¤í¬ë¡¤ ì¹´ë“œ ë¦¬ìŠ¤íŠ¸ -->
        <div class="flex overflow-x-auto space-x-4 pb-4 scrollbar-hide">
            <div th:each="item : ${weather.shortTermForecasts}"
                 class="min-w-[140px] bg-white/90 backdrop-blur-sm p-4 rounded-2xl shadow-lg border border-white/40 flex flex-col items-center justify-between hover:scale-105 transition duration-300">

                    <span class="text-gray-500 font-bold text-sm bg-gray-100 px-3 py-1 rounded-full mb-2">
                        <span th:text="${#strings.substring(item.fcstTime, 0, 2)}">12</span>:00
                    </span>

                <div class="text-4xl my-2 text-gray-600">
                    <i th:if="${item.PTY != '0'}" class="fas fa-umbrella text-blue-400 drop-shadow-sm"></i>
                    <i th:if="${item.PTY == '0' && item.SKY == '1'}" class="fas fa-sun text-yellow-400 drop-shadow-sm"></i>
                    <i th:if="${item.PTY == '0' && item.SKY == '3'}" class="fas fa-cloud-sun text-gray-400 drop-shadow-sm"></i>
                    <i th:if="${item.PTY == '0' && item.SKY == '4'}" class="fas fa-cloud text-gray-500 drop-shadow-sm"></i>
                </div>

                <div class="text-2xl font-bold text-gray-800 mb-1">
                    <span th:text="${item.T1H}"></span>Â°
                </div>

                <!-- ë‚™ë¢° ì£¼ì˜ -->
                <div th:if="${item.LGT != '0' && item.LGT != '-100' && item.LGT != null}" class="text-xs font-bold text-red-500 bg-red-50 px-2 py-1 rounded flex items-center gap-1 mb-1 animate-pulse">
                    <i class="fas fa-bolt"></i> ë‚™ë¢°ì£¼ì˜
                </div>

                <div class="text-xs text-gray-400 text-center w-full border-t border-gray-200 pt-2 mt-2 space-y-1">
                    <div class="flex justify-between w-full">
                        <span><i class="fas fa-tint text-blue-300"></i></span>
                        <span th:text="${item.REH} + '%'"></span>
                    </div>
                    <div class="flex justify-between w-full">
                        <span><i class="fas fa-wind text-gray-300"></i></span>
                        <span th:text="${item.WSD} + 'm/s'"></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- ê·¸ë˜í”„ ì˜ì—­ -->
        <div class="bg-white/95 backdrop-blur-md p-6 rounded-3xl shadow-lg border border-white/50 mt-6">
            <h4 class="text-sm font-bold text-slate-500 mb-4 flex items-center">
                <i class="fas fa-chart-line mr-2 text-blue-500"></i>ê¸°ì˜¨ ë° ìŠµë„ ë³€í™” ì¶”ì´
            </h4>
            <div class="relative h-64 w-full">
                <canvas id="weatherChart"></canvas>
            </div>
        </div>
    </div>

    <!-- 5. [AI] ì˜·ì°¨ë¦¼ ì¶”ì²œ ì¹´ë“œ -->
    <div class="bg-gradient-to-r from-violet-600 to-fuchsia-600 rounded-3xl p-8 shadow-2xl mb-10 text-white relative overflow-hidden flex flex-col md:flex-row items-center gap-8 border border-white/20">
        <!-- ë°°ê²½ ë°ì½”ë ˆì´ì…˜ -->
        <div class="absolute top-0 right-0 -mr-20 -mt-20 w-64 h-64 bg-white opacity-10 rounded-full blur-3xl pointer-events-none"></div>
        <div class="absolute bottom-0 left-0 -ml-20 -mb-20 w-64 h-64 bg-yellow-300 opacity-10 rounded-full blur-3xl pointer-events-none"></div>

        <!-- ì•„ì´ì½˜ ì˜ì—­ -->
        <div class="bg-white/20 p-6 rounded-full backdrop-blur-md shadow-[0_0_20px_rgba(255,255,255,0.3)] hidden md:flex items-center justify-center">
            <div class="text-5xl text-white">
                <i class="fas fa-robot"></i>
            </div>
        </div>

        <!-- í…ìŠ¤íŠ¸ ë‚´ìš© -->
        <div class="relative z-10 flex-1 w-full">
            <div class="flex items-center justify-between mb-2">
                <h3 class="text-sm font-bold uppercase tracking-wider text-violet-100 bg-white/10 px-3 py-1 rounded-full inline-block">
                    <i class="fas fa-sparkles text-yellow-300 mr-1"></i> AI Outfit Suggestion
                </h3>
            </div>
            <h2 class="text-2xl font-bold mb-4">ì˜¤ëŠ˜ ë­ ì…ì§€?</h2>

            <div class="flex items-start gap-4 bg-black/20 p-5 rounded-2xl backdrop-blur-md border border-white/10 shadow-inner">
                <div class="text-3xl mt-1 text-white/90 bg-white/10 p-2 rounded-lg">
                    <i th:class="${weather.outfitIcon}"></i>
                </div>
                <div>
                    <p class="text-lg font-medium leading-relaxed text-white/95">
                        <span th:utext="${weather.clothingRecommendation}"></span>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- AI ë‚ ì”¨ DJ ì¹´ë“œ -->
    <div class="bg-black/80 backdrop-blur-md rounded-3xl p-6 shadow-2xl border border-gray-700 mb-10 text-white flex flex-col md:flex-row gap-6">
        <!-- ì•¨ë²” ì•„íŠ¸ / ìœ íŠœë¸Œ í”Œë ˆì´ì–´ -->
        <div class="w-full md:w-1/3 aspect-video md:aspect-square rounded-2xl overflow-hidden shadow-lg border border-gray-600 bg-black relative group">
            <iframe th:src="'https://www.youtube.com/embed/' + ${weather.youtubeVideoId} + '?autoplay=0&controls=1&showinfo=0&rel=0'"
                    title="YouTube video player" frameborder="0"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                    allowfullscreen
                    class="absolute inset-0 w-full h-full"></iframe>
        </div>

        <!-- DJ ë©˜íŠ¸ ë° ì •ë³´ -->
        <div class="flex-1 flex flex-col justify-center">
            <div class="flex items-center gap-2 mb-3">
                <span class="text-xs font-bold text-black bg-green-400 px-2 py-1 rounded-full uppercase tracking-wider">Now Playing</span>
                <h3 class="text-sm font-bold text-gray-400 uppercase tracking-widest"><i class="fas fa-headphones-alt mr-1"></i> AI Weather DJ</h3>
            </div>

            <h2 class="text-2xl font-bold mb-4 text-white">ë‚ ì”¨ì— ë”± ë§ëŠ” ì„ ê³¡ ğŸµ</h2>

            <div class="bg-white/10 p-5 rounded-2xl backdrop-blur-sm border border-white/10">
                <p class="text-lg font-light leading-relaxed text-gray-200">
                    "<span th:text="${weather.musicComment}">ìŒì•…ì„ ê³ ë¥´ëŠ” ì¤‘ì…ë‹ˆë‹¤...</span>"
                </p>
            </div>

            <div class="mt-4 flex gap-4 text-sm text-gray-500">
                <span class="flex items-center gap-1"><i class="fas fa-cloud"></i> ë‚ ì”¨ ê¸°ë°˜ ì¶”ì²œ</span>
                <span class="flex items-center gap-1"><i class="fas fa-clock"></i> ì‹œê°„ëŒ€ ë°˜ì˜</span>
            </div>
        </div>
    </div>


    <!-- 6. ë‚´ì¼ & ëª¨ë ˆ ë‚ ì”¨ (ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ) -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-10">
        <!-- (ë‚´ì¼ ë‚ ì”¨ ìƒëµ - ê¸°ì¡´ ì½”ë“œ ìœ ì§€) -->
        <div class="flex flex-col h-full">
            <h3 class="text-xl font-bold text-white mb-4 px-1 flex items-center justify-between drop-shadow-md">
                <div class="flex items-center">
                    <i class="fas fa-calendar-day text-green-300 mr-2"></i>
                    <span class="mr-2">ë‚´ì¼ ë‚ ì”¨</span>
                    <span class="text-xs font-normal text-gray-600 bg-white/90 px-2 py-1 rounded-full shadow-sm"
                          th:if="${weather.tomorrowFcstDate != null}"
                          th:text="${#strings.substring(weather.tomorrowFcstDate, 4, 6)} + 'ì›” ' + ${#strings.substring(weather.tomorrowFcstDate, 6, 8)} + 'ì¼'">
                        </span>
                </div>
                <!-- ë‚´ì¼ ìµœì €/ìµœê³  ê¸°ì˜¨ í‘œì‹œ -->
                <span class="text-sm font-medium text-white/90 bg-black/20 px-3 py-1 rounded-full backdrop-blur-sm shadow-sm"
                      th:if="${weather.tomorrowTMN != null && weather.tomorrowTMX != null}">
                        <i class="fas fa-temperature-low text-blue-300"></i> <span th:text="${weather.tomorrowTMN}"></span>Â°
                        <span class="mx-1 opacity-50">/</span>
                        <i class="fas fa-temperature-high text-red-300"></i> <span th:text="${weather.tomorrowTMX}"></span>Â°
                    </span>
            </h3>

            <div th:if="${#lists.isEmpty(weather.tomorrowForecasts)}" class="flex-1 flex flex-col justify-center items-center text-center py-12 bg-white/90 backdrop-blur-sm rounded-3xl shadow-lg">
                <i class="fas fa-hourglass-half mb-3 text-3xl text-gray-300"></i><br>
                <span class="text-gray-500 font-medium">ë‚´ì¼ ì˜ˆë³´ ë°ì´í„° ìƒì„± ì¤‘...<br>(ì˜¤í›„ 5ì‹œ ì´í›„ ì •í™•í•´ì§‘ë‹ˆë‹¤)</span>
            </div>

            <div th:unless="${#lists.isEmpty(weather.tomorrowForecasts)}" class="flex-1 flex overflow-x-auto space-x-4 pb-4 scrollbar-hide items-stretch">
                <div th:each="item : ${weather.tomorrowForecasts}" class="min-w-[120px] bg-white/90 backdrop-blur-sm p-4 rounded-2xl shadow-md border border-white/40 flex flex-col items-center justify-between hover:bg-white transition group h-full">
                        <span class="text-gray-500 font-bold text-xs bg-gray-100 px-2 py-1 rounded-full mb-2 group-hover:bg-green-100 group-hover:text-green-600 transition">
                            <span th:text="${#strings.substring(item.fcstTime, 0, 2)}">12</span>:00
                        </span>
                    <div class="text-2xl my-2 text-gray-600">
                        <i th:if="${item.PTY != '0'}" class="fas fa-umbrella text-blue-500"></i>
                        <i th:if="${item.PTY == '0' && item.SKY == '1'}" class="fas fa-sun text-yellow-400"></i>
                        <i th:if="${item.PTY == '0' && item.SKY == '3'}" class="fas fa-cloud-sun text-gray-400"></i>
                        <i th:if="${item.PTY == '0' && item.SKY == '4'}" class="fas fa-cloud text-gray-400"></i>
                    </div>
                    <div class="text-lg font-bold text-gray-800"><span th:text="${item.getTemp()}"></span>Â°</div>
                    <div class="mt-auto pt-2 w-full text-center">
                        <div class="text-xs text-blue-500 font-bold bg-blue-50 px-2 py-0.5 rounded-full inline-block" th:if="${item.POP != '0'}">
                            <i class="fas fa-tint text-[10px] mr-1"></i><span th:text="${item.POP} + '%'"></span>
                        </div>
                        <div class="text-xs text-transparent font-bold px-2 py-0.5" th:unless="${item.POP != '0'}">-</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ëª¨ë ˆ ë‚ ì”¨ -->
        <div class="flex flex-col h-full">
            <h3 class="text-xl font-bold text-white mb-4 px-1 flex items-center justify-between drop-shadow-md">
                <div class="flex items-center">
                    <i class="fas fa-calendar-week text-purple-300 mr-2"></i>
                    <span class="mr-2">ëª¨ë ˆ ë‚ ì”¨</span>
                    <span class="text-xs font-normal text-gray-600 bg-white/90 px-2 py-1 rounded-full shadow-sm"
                          th:if="${weather.dayAfterTomorrowFcstDate != null}"
                          th:text="${#strings.substring(weather.dayAfterTomorrowFcstDate, 4, 6)} + 'ì›” ' + ${#strings.substring(weather.dayAfterTomorrowFcstDate, 6, 8)} + 'ì¼'">
                        </span>
                </div>
                <!-- ëª¨ë ˆ ìµœì €/ìµœê³  ê¸°ì˜¨ í‘œì‹œ -->
                <span class="text-sm font-medium text-white/90 bg-black/20 px-3 py-1 rounded-full backdrop-blur-sm shadow-sm"
                      th:if="${weather.dayAfterTomorrowTMN != null && weather.dayAfterTomorrowTMX != null}">
                        <i class="fas fa-temperature-low text-blue-300"></i> <span th:text="${weather.dayAfterTomorrowTMN}"></span>Â°
                        <span class="mx-1 opacity-50">/</span>
                        <i class="fas fa-temperature-high text-red-300"></i> <span th:text="${weather.dayAfterTomorrowTMX}"></span>Â°
                    </span>
            </h3>

            <div th:if="${#lists.isEmpty(weather.dayAfterTomorrowForecasts)}" class="flex-1 flex flex-col justify-center items-center text-center py-12 bg-white/90 backdrop-blur-sm rounded-3xl shadow-lg">
                <i class="fas fa-hourglass-half mb-3 text-3xl text-gray-300"></i><br>
                <span class="text-gray-500 font-medium">ëª¨ë ˆ ì˜ˆë³´ ë°ì´í„° ìƒì„± ì¤‘...</span>
            </div>

            <div th:unless="${#lists.isEmpty(weather.dayAfterTomorrowForecasts)}" class="flex-1 flex overflow-x-auto space-x-4 pb-4 scrollbar-hide items-stretch">
                <div th:each="item : ${weather.dayAfterTomorrowForecasts}" class="min-w-[120px] bg-white/90 backdrop-blur-sm p-4 rounded-2xl shadow-md border border-white/40 flex flex-col items-center justify-between hover:bg-white transition group h-full">
                        <span class="text-gray-500 font-bold text-xs bg-gray-100 px-2 py-1 rounded-full mb-2 group-hover:bg-purple-100 group-hover:text-purple-600 transition">
                            <span th:text="${#strings.substring(item.fcstTime, 0, 2)}">12</span>:00
                        </span>
                    <div class="text-2xl my-2 text-gray-600">
                        <i th:if="${item.PTY != '0'}" class="fas fa-umbrella text-blue-500"></i>
                        <i th:if="${item.PTY == '0' && item.SKY == '1'}" class="fas fa-sun text-yellow-400"></i>
                        <i th:if="${item.PTY == '0' && item.SKY == '3'}" class="fas fa-cloud-sun text-gray-400"></i>
                        <i th:if="${item.PTY == '0' && item.SKY == '4'}" class="fas fa-cloud text-gray-400"></i>
                    </div>
                    <div class="text-lg font-bold text-gray-800"><span th:text="${item.getTemp()}"></span>Â°</div>
                    <div class="mt-auto pt-2 w-full text-center">
                        <div class="text-xs text-blue-500 font-bold bg-blue-50 px-2 py-0.5 rounded-full inline-block" th:if="${item.POP != '0'}">
                            <i class="fas fa-tint text-[10px] mr-1"></i><span th:text="${item.POP} + '%'"></span>
                        </div>
                        <div class="text-xs text-transparent font-bold px-2 py-0.5" th:unless="${item.POP != '0'}">-</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 7. ì˜¤ëŠ˜ ìƒì„¸ ë°ì´í„° (ê·¸ë¦¬ë“œ) -->
    <div class="mb-10">
        <!-- (ê¸°ì¡´ ìƒì„¸ ë°ì´í„° ì½”ë“œ ìœ ì§€) -->
        <h3 class="text-xl font-bold text-white mb-4 px-1 flex items-center drop-shadow-md">
            <i class="fas fa-chart-bar text-teal-300 mr-2"></i>ì˜¤ëŠ˜ ìƒì„¸ ë‚ ì”¨
        </h3>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <div class="bg-white p-5 rounded-2xl shadow-sm border hover:shadow-md transition">
                <p class="text-xs text-gray-400 font-bold mb-1">ê°•ìˆ˜í™•ë¥ </p>
                <div class="text-2xl font-bold text-gray-800"><i class="fas fa-umbrella text-blue-400 mr-2"></i><span th:text="${weather.POP}">-</span>%</div>
            </div>
            <div class="bg-white p-5 rounded-2xl shadow-sm border hover:shadow-md transition">
                <p class="text-xs text-gray-400 font-bold mb-1">ìŠµë„</p>
                <div class="text-2xl font-bold text-gray-800"><i class="fas fa-tint text-indigo-400 mr-2"></i><span th:text="${weather.REH}">-</span>%</div>
            </div>
            <div class="bg-white p-5 rounded-2xl shadow-sm border hover:shadow-md transition">
                <p class="text-xs text-gray-400 font-bold mb-1">í’ì†</p>
                <div class="text-2xl font-bold text-gray-800"><i class="fas fa-wind text-gray-400 mr-2"></i><span th:text="${weather.WSD}">-</span>m/s</div>
            </div>
            <div class="bg-white p-5 rounded-2xl shadow-sm border hover:shadow-md transition">
                <p class="text-xs text-gray-400 font-bold mb-1">íŒŒê³ </p>
                <div class="text-2xl font-bold text-gray-800"><i class="fas fa-water text-blue-600 mr-2"></i><span th:text="${weather.WAV}">-</span>M</div>
            </div>
            <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100">
                <p class="text-xs text-slate-400 font-bold uppercase mb-1">1ì‹œê°„ ê°•ìˆ˜ëŸ‰</p>
                <div class="text-lg font-bold text-slate-700"><span th:text="${weather.PCP}">-</span></div>
            </div>
            <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100">
                <p class="text-xs text-slate-400 font-bold uppercase mb-1">1ì‹œê°„ ì ì„¤</p>
                <div class="text-lg font-bold text-slate-700"><span th:text="${weather.SNO}">-</span></div>
            </div>
            <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100">
                <p class="text-xs text-slate-400 font-bold uppercase mb-1">ë™ì„œë°”ëŒ</p>
                <div class="text-lg font-bold text-slate-700"><span th:text="${weather.UUU}">-</span> m/s</div>
            </div>
            <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100">
                <p class="text-xs text-slate-400 font-bold uppercase mb-1">ë‚¨ë¶ë°”ëŒ</p>
                <div class="text-lg font-bold text-slate-700"><span th:text="${weather.VVV}">-</span> m/s</div>
            </div>
        </div>
    </div>

    <!-- 8. ìƒí™œ ê¸°ìƒ ì§€ìˆ˜ & ë¯¸ì„¸ë¨¼ì§€ -->
    <div class="mb-10">
        <h3 class="text-xl font-bold text-white mb-4 px-1 flex items-center drop-shadow-md">
            <i class="fas fa-heart text-pink-300 mr-2"></i>ìƒí™œ ë° ëŒ€ê¸° ì •ë³´
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- ìì™¸ì„  -->
            <div class="bg-white/90 backdrop-blur-sm rounded-2xl p-6 shadow-md border border-orange-100/50 flex items-center justify-between hover:shadow-lg transition">
                <div>
                    <div class="text-sm font-bold text-orange-500 mb-1 flex items-center gap-1"><i class="fas fa-sun"></i> ìì™¸ì„  ì§€ìˆ˜</div>
                    <div class="text-3xl font-bold text-gray-800 mb-2">
                        <span th:text="${weather.uvStage}">-</span>
                        <span class="text-lg text-gray-400 font-normal" th:text="'(' + ${weather.uvIndex} + ')'"></span>
                    </div>
                    <p class="text-sm text-gray-500 leading-tight" th:text="${weather.uvComment}">ì •ë³´ ë¡œë”©ì¤‘...</p>
                </div>
                <div class="text-5xl text-orange-200 opacity-50"><i class="fas fa-umbrella-beach"></i></div>
            </div>

            <!-- [REPLACED] ë¯¸ì„¸ë¨¼ì§€ ì¹´ë“œ (ëŒ€ê¸°í™•ì‚° ëŒ€ì²´) -->
            <div class="bg-white/90 backdrop-blur-sm rounded-2xl p-6 shadow-md border border-gray-100/50 flex items-center justify-between hover:shadow-lg transition">
                <div>
                    <div class="text-sm font-bold text-gray-600 mb-1 flex items-center gap-1"><i class="fas fa-smog"></i> ë¯¸ì„¸ë¨¼ì§€(PM10)</div>
                    <div class="text-3xl font-bold text-gray-800 mb-2">
                        <span th:text="${weather.getGradeText(weather.pm10Grade)}">-</span>
                        <span class="text-lg text-gray-400 font-normal" th:text="'(' + ${weather.pm10Value} + 'ã/ã¥)'"></span>
                    </div>
                    <p class="text-sm text-gray-500 leading-tight" th:text="${weather.dustComment}">ëŒ€ê¸° ì •ë³´ ìˆ˜ì‹  ì¤‘...</p>
                </div>
                <div class="text-5xl opacity-50"
                     th:classappend="${weather.pm10Grade == '1' ? 'text-blue-200' : (weather.pm10Grade == '2' ? 'text-green-200' : (weather.pm10Grade == '3' ? 'text-yellow-200' : 'text-red-200'))}">
                    <i class="fas fa-mask"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- 9. ì¬ë‚œ ì•ˆì „ ìƒí™©ì‹¤ (ê¸°ëŠ¥ ê°•í™”) -->
    <div class="mb-10">
        <h3 class="text-xl font-bold text-white mb-4 px-1 flex items-center drop-shadow-md">
            <i class="fas fa-shield-alt text-red-400 mr-2 animate-pulse"></i>ì¬ë‚œ ì•ˆì „ ë¸Œë¦¬í•‘ (AI ë¶„ì„)
        </h3>
        <div class="grid grid-cols-1 gap-4">

            <!-- ê¸°ìƒíŠ¹ë³´ -->
            <div th:if="${weather.hasWarning}" class="bg-red-50/95 backdrop-blur-sm border-l-8 border-red-500 p-6 rounded-r-2xl shadow-md flex items-start gap-5 animate-pulse">
                <div class="text-4xl text-red-500 mt-1"><i class="fas fa-exclamation-triangle"></i></div>
                <div>
                    <h4 class="text-xl font-bold text-red-700 mb-2">ê¸°ìƒíŠ¹ë³´ ë°œíš¨ ì¤‘</h4>
                    <p class="text-red-600 whitespace-pre-line leading-relaxed font-medium" th:text="${weather.warningMsg}"></p>
                </div>
            </div>

            <!-- ì§€ì§„ ì •ë³´ (ê±°ë¦¬ í‘œì‹œ ì¶”ê°€) -->
            <div th:if="${weather.hasEarthquake}" class="bg-yellow-50/95 backdrop-blur-sm border-l-8 border-yellow-500 p-6 rounded-r-2xl shadow-md flex items-start gap-5">
                <div class="text-4xl text-yellow-600 mt-1"><i class="fas fa-rss"></i></div>
                <div class="flex-1">
                    <div class="flex justify-between items-center mb-2">
                        <h4 class="text-xl font-bold text-yellow-800">ìµœê·¼ ì§€ì§„ ì •ë³´ (ê±°ë¦¬: <span th:text="${weather.eqDist}"></span>)</h4>
                        <span class="text-sm text-yellow-700 font-bold bg-yellow-200/50 px-2 py-1 rounded" th:text="${weather.eqTime}"></span>
                    </div>
                    <div class="flex items-center gap-3 mb-2">
                        <span class="bg-yellow-200 text-yellow-800 px-2 py-0.5 rounded text-sm font-bold">ê·œëª¨ <span th:text="${weather.eqMag}"></span></span>
                        <span class="text-yellow-800 font-medium text-lg" th:text="${weather.eqLoc}"></span>
                    </div>
                    <div class="bg-white/50 p-3 rounded-lg border border-yellow-200 mb-3">
                        <p class="text-sm font-bold text-yellow-900 flex items-center">
                            <i class="fas fa-robot mr-2"></i>AI ì•ˆì „ ë¶„ì„:
                            <span class="font-normal ml-1" th:text="${weather.eqSafetyMsg}"></span>
                        </p>
                    </div>
                    <a href="/earthquake" class="text-sm text-yellow-800 hover:text-yellow-950 font-bold underline inline-block transition">
                        <i class="fas fa-list-ul mr-1"></i> ì „ì²´ ëª©ë¡ ë³´ê¸°
                    </a>
                </div>
            </div>

            <!-- íƒœí’ ì •ë³´ (ê±°ë¦¬ í‘œì‹œ ì¶”ê°€) -->
            <div th:if="${weather.hasTyphoon}" class="bg-blue-50/95 backdrop-blur-sm border-l-8 border-blue-500 p-6 rounded-r-2xl shadow-md flex items-start gap-5">
                <div class="text-4xl text-blue-600 mt-1"><i class="fas fa-hurricane animate-spin-slow"></i></div>
                <div class="flex-1">
                    <div class="flex justify-between items-center mb-2">
                        <h4 class="text-xl font-bold text-blue-800">íƒœí’ í™œë™ ì¤‘ (ê±°ë¦¬: <span th:text="${weather.typhoonDist}"></span>)</h4>
                        <span class="text-sm text-blue-700 font-bold bg-blue-200/50 px-2 py-1 rounded" th:text="${weather.typhoonTime}"></span>
                    </div>
                    <p class="text-blue-800 font-extrabold text-2xl mb-1" th:text="${weather.typhoonName}"></p>
                    <p class="text-blue-600 text-sm mb-3 font-medium" th:text="${weather.typhoonStatus}"></p>

                    <div class="bg-white/50 p-3 rounded-lg border border-blue-200 mb-3">
                        <p class="text-sm font-bold text-blue-900 flex items-center">
                            <i class="fas fa-robot mr-2"></i>AI ì•ˆì „ ë¶„ì„:
                            <span class="font-normal ml-1" th:text="${weather.typhoonSafetyMsg}"></span>
                        </p>
                    </div>
                    <a href="/typhoon" class="text-sm text-blue-800 hover:text-blue-950 font-bold underline inline-block transition">
                        <i class="fas fa-map mr-1"></i> ì „ì²´ ê²½ë¡œ í™•ì¸í•˜ê¸°
                    </a>
                </div>
            </div>

            <!-- ì•ˆì „í•  ë•Œ í‘œì‹œ (ìˆ˜ì •ë¨: ë°”ë¡œê°€ê¸° ë²„íŠ¼ ì¶”ê°€) -->
            <div th:if="${!weather.hasWarning && !weather.hasTyphoon && !weather.hasEarthquake}" class="bg-green-50/90 backdrop-blur-sm border-l-8 border-green-500 p-6 rounded-r-2xl shadow-md">
                <div class="flex items-start gap-5">
                    <div class="text-4xl text-green-500 mt-1"><i class="fas fa-shield-check"></i></div>
                    <div class="flex-1">
                        <h4 class="text-xl font-bold text-green-700 mb-1">ì¬ë‚œ ì•ˆì „ ìƒíƒœ 'ì–‘í˜¸'</h4>
                        <p class="text-green-600 font-medium mb-4">í˜„ì¬ ì‚¬ìš©ì ìœ„ì¹˜ ì£¼ë³€ì— ì£¼ìš” ìœ„í—˜ ìš”ì†Œê°€ ì—†ìŠµë‹ˆë‹¤.</p>

                        <!-- ì§€ë‚œ ê¸°ë¡ ë°”ë¡œê°€ê¸° ë²„íŠ¼ ì¶”ê°€ -->
                        <div class="flex flex-wrap gap-3">
                            <a href="/earthquake" class="inline-flex items-center text-sm font-bold text-green-700 bg-white/60 px-4 py-2 rounded-lg hover:bg-white transition shadow-sm border border-green-200/50">
                                <i class="fas fa-rss mr-2"></i>ì§€ë‚œ ì§€ì§„ ê¸°ë¡
                            </a>
                            <a href="/typhoon" class="inline-flex items-center text-sm font-bold text-green-700 bg-white/60 px-4 py-2 rounded-lg hover:bg-white transition shadow-sm border border-green-200/50">
                                <i class="fas fa-wind mr-2"></i>ì§€ë‚œ íƒœí’ ê¸°ë¡
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- í•˜ë‹¨ ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ -->
    <button onclick="location.reload()" class="w-full bg-white/20 hover:bg-white/30 backdrop-blur-md text-white font-bold py-4 rounded-xl shadow-lg transition border border-white/50 active:scale-[0.98] duration-200">
        <i class="fas fa-sync-alt mr-2 animate-spin-slow-on-hover"></i> ì „ì²´ ë°ì´í„° ìƒˆë¡œê³ ì¹¨
    </button>

    <!-- í‘¸í„° -->
    <div class="mt-8 pb-8 text-center text-white/60 text-xs font-light">
        <p class="mb-1">ë°ì´í„° ì¶œì²˜: ê³µê³µë°ì´í„°í¬í„¸ (ê¸°ìƒì²­ API, ì—ì–´ì½”ë¦¬ì•„)</p>
        <p>AI Analysis Powered by Python & Scikit-learn</p>
    </div>

</div>

<!-- [ìŠ¤í¬ë¦½íŠ¸] Chart.js ê·¸ë˜í”„ ìƒì„± ë¡œì§ -->
<script th:inline="javascript">
    // [NEW] ë¬´ë£Œ AI ìºìŠ¤í„° (TTS) ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€
    function speakBriefing() {
        const text = document.getElementById('aiBriefingText').innerText;
        if (!text) {
            alert('ì½ì–´ì¤„ ë¸Œë¦¬í•‘ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.');
            return;
        }

        // ë¸Œë¼ìš°ì € ë‚´ì¥ TTS ê¸°ëŠ¥ ì‚¬ìš© (ë¬´ë£Œ)
        const speech = new SpeechSynthesisUtterance();
        speech.text = text;
        speech.lang = 'ko-KR'; // í•œêµ­ì–´ ì„¤ì •
        speech.rate = 1.0; // ì†ë„ (0.1 ~ 10)
        speech.pitch = 1.0; // ìŒë†’ì´ (0 ~ 2)
        speech.volume = 1.0; // ë³¼ë¥¨

        // ëª©ì†Œë¦¬ ì„ íƒ (ê°€ëŠ¥í•˜ë‹¤ë©´ Google í•œêµ­ì–´ ë³´ì´ìŠ¤ ì„ íƒ)
        const voices = window.speechSynthesis.getVoices();
        const koVoice = voices.find(v => v.lang.includes('ko') || v.name.includes('Google í•œêµ­ì–´'));
        if (koVoice) {
            speech.voice = koVoice;
        }

        // ê¸°ì¡´ ìŒì„±ì´ ìˆë‹¤ë©´ ì·¨ì†Œí•˜ê³  ìƒˆë¡œ ì¬ìƒ
        window.speechSynthesis.cancel();
        window.speechSynthesis.speak(speech);
    }

    // Chart.js ë¡œì§ (ê¸°ì¡´ ìœ ì§€)
    document.addEventListener("DOMContentLoaded", function() {
        // [ì¤‘ìš”] TTS ëª©ì†Œë¦¬ ëª©ë¡ ë¡œë“œ íŠ¸ë¦¬ê±° (í¬ë¡¬ ë“± ì¼ë¶€ ë¸Œë¼ìš°ì €ëŠ” ë¹„ë™ê¸°ë¡œ ë¡œë“œë¨)
        window.speechSynthesis.getVoices();

        const ctx = document.getElementById('weatherChart');
        if (!ctx) return;

        const labels = [];
        const tempPoints = [];
        const humidityPoints = [];

        /*[# th:each="item : ${weather.shortTermForecasts}"]*/
            labels.push(/*[[${#strings.substring(item.fcstTime, 0, 2)} + ':00']]*/ "12:00");
            tempPoints.push(/*[[${item.T1H}]]*/ 20);
            humidityPoints.push(/*[[${item.REH}]]*/ 50);
        /*[/]*/

        new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: 'ê¸°ì˜¨ (Â°C)',
                        data: tempPoints,
                        borderColor: '#3b82f6', // blue-500
                        backgroundColor: '#3b82f6',
                        yAxisID: 'y',
                        tension: 0.4,
                        borderWidth: 3,
                        pointRadius: 4,
                        pointBackgroundColor: '#fff',
                        pointBorderWidth: 2
                    },
                    {
                        label: 'ìŠµë„ (%)',
                        data: humidityPoints,
                        borderColor: '#a855f7', // purple-500
                        backgroundColor: 'rgba(168, 85, 247, 0.1)',
                        yAxisID: 'y1',
                        tension: 0.4,
                        borderWidth: 2,
                        borderDash: [5, 5],
                        pointRadius: 3,
                        fill: true
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: { mode: 'index', intersect: false },
                plugins: {
                    legend: { position: 'top', align: 'end', labels: { usePointStyle: true, boxWidth: 8, font: { family: "'Noto Sans KR', sans-serif" } } },
                    tooltip: {
                        backgroundColor: 'rgba(255, 255, 255, 0.9)',
                        titleColor: '#1e293b',
                        bodyColor: '#1e293b',
                        borderColor: '#e2e8f0',
                        borderWidth: 1,
                        padding: 10,
                        bodyFont: { family: "'Noto Sans KR', sans-serif" },
                        callbacks: {
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) label += ': ';
                                if (context.parsed.y !== null) label += context.parsed.y;
                                return label;
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        type: 'linear',
                        display: true,
                        position: 'left',
                        title: { display: true, text: 'ê¸°ì˜¨ (Â°C)', color: '#3b82f6', font: {size: 11, weight: 'bold'} },
                        grid: { color: '#f1f5f9' },
                        ticks: { color: '#3b82f6' }
                    },
                    y1: {
                        type: 'linear',
                        display: true,
                        position: 'right',
                        title: { display: true, text: 'ìŠµë„ (%)', color: '#a855f7', font: {size: 11, weight: 'bold'} },
                        grid: { display: false },
                        min: 0,
                        max: 100,
                        ticks: { color: '#a855f7' }
                    },
                    x: { grid: { display: false }, ticks: { color: '#64748b' } }
                }
            }
        });
    });

    const modal = document.getElementById('predictModal');
    const iframe = document.getElementById('predictFrame');

    function openModal() {
        modal.classList.remove('hidden');
        document.body.style.overflow = 'hidden';

        // iframe ë‚´ë¶€ì˜ resetAll í•¨ìˆ˜ í˜¸ì¶œ (ìƒˆë¡œê³ ì¹¨ ì—†ì´ ê°’ë§Œ ì´ˆê¸°í™”)
        if (iframe && iframe.contentWindow.resetAll) {
            iframe.contentWindow.resetAll();
        }
    }

    function closeModal() {
        modal.classList.add('hidden');
        document.body.style.overflow = 'auto';

        // ë‹«ì„ ë•Œë„ ë¯¸ë¦¬ ë¹„ì›Œë‘ë©´ ë‹¤ìŒì— ì—´ ë•Œ ë” ê¹”ë”í•©ë‹ˆë‹¤.
        if (iframe && iframe.contentWindow.resetAll) {
            iframe.contentWindow.resetAll();
        }
    }

    window.onkeydown = function(event) {
        if (event.key === "Escape" && !modal.classList.contains('hidden')) {
            closeModal();
        }
    };
</script>
</body>
</html>